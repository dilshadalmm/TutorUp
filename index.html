<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Disable zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ChemTutor - Chemistry Learning Platform</title>

    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Custom styles for the Inter font, dark theme, and functionality */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #f8fafc; /* slate-50 */
            -webkit-user-select: none; /* Safari */
            -ms-user-select: none; /* IE 10 and IE 11 */
            user-select: none; /* Standard syntax */
            overflow: hidden; /* Prevent body scrolling */
            height: 100vh;
        }
        
        .page {
            display: none; /* Hide all pages by default */
            animation: fadeIn 0.5s ease-in-out;
            height: 100vh;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .page.active {
            display: block; /* Show active page */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Hide scrollbar for Chrome, Safari and Opera */
        #content-area::-webkit-scrollbar,
        #chapters-page-container::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        #content-area, #chapters-page-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Class to show gradient fade on collapsed description (from lecture page) */
        .description-collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4rem;
            background: linear-gradient(to top, #1e293b, transparent);
            pointer-events: none;
        }
        
        /* Ensure the video player container has no extra space (from lecture page) */
        #video-player-container {
            line-height: 0;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Container for all pages, also the touch surface for gestures -->
    <div id="app-container" class="relative h-full w-full">

        <!-- ====================================================== -->
        <!-- Landing Page -->
        <!-- ====================================================== -->
        <div id="landing-page" class="page active">
            <div class="h-full flex flex-col items-center justify-center p-4 bg-slate-900 relative overflow-hidden">
                <!-- Background Glow Effect -->
                <div class="absolute top-1/2 left-1/2 w-[60rem] h-[60rem] bg-indigo-600/30 rounded-full -translate-x-1/2 -translate-y-1/2 blur-3xl animate-pulse"></div>
                
                <div class="relative z-10 text-center">
                    <div class="flex items-center justify-center mb-4">
                         <svg class="w-16 h-16 text-indigo-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="m10 14.1 3.5 2.4-3.5 2.4v-4.8Z"></path><path d="M10 12v-1.42a2.95 2.95 0 0 1 2.4-2.83l.6-.15a2.95 2.95 0 0 0 2.4-2.83V4"></path></svg>
                        <h1 class="text-5xl md:text-6xl font-extrabold text-white ml-2">ChemTutor</h1>
                    </div>
                    <p class="text-lg md:text-xl text-slate-300 max-w-2xl mx-auto mt-4 mb-8">
                        Unlock the world of chemistry with engaging video lectures, interactive modules, and expert guidance. Your journey to mastering chemistry starts here.
                    </p>
                    <button id="get-started-btn" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-lg py-4 px-8 rounded-full transition-transform duration-300 transform hover:scale-105 shadow-lg shadow-indigo-600/30">
                        Get Started
                    </button>
                </div>
            </div>
        </div>

        <!-- ====================================================== -->
        <!-- Authentication Page -->
        <!-- ====================================================== -->
        <div id="auth-page" class="page">
            <div class="h-full flex items-center justify-center bg-slate-900 p-4 overflow-y-auto">
                <div class="w-full max-w-md p-8 space-y-6 bg-slate-800 rounded-2xl shadow-xl">
                    <h2 class="text-3xl font-bold text-center text-white">Welcome Back</h2>
                    <p class="text-center text-slate-400">Sign in to continue your learning journey.</p>
                    <form id="login-form" class="space-y-6">
                        <div>
                            <label for="email" class="text-sm font-semibold text-slate-300 block mb-2">Email Address</label>
                            <input type="email" name="email" id="email" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="you@example.com" required>
                        </div>
                        <div>
                            <label for="password" class="text-sm font-semibold text-slate-300 block mb-2">Password</label>
                            <input type="password" name="password" id="password" class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="••••••••" required>
                        </div>
                        <button type="submit" class="w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-semibold transition-colors">
                            Sign In
                        </button>
                    </form>
                    <p id="auth-error" class="text-sm text-center text-red-400 h-4"></p>
                </div>
            </div>
        </div>
        
        <!-- ====================================================== -->
        <!-- Chapters Page (Revamped) -->
        <!-- ====================================================== -->
        <div id="chapters-page" class="page">
            <div id="chapters-page-container" class="h-full bg-gradient-to-br from-slate-900 to-indigo-900/30 p-4 sm:p-6 lg:p-8 overflow-y-auto">
                 <div class="max-w-7xl mx-auto text-center">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-2 pt-8">Course Curriculum</h1>
                    <p class="text-lg text-slate-400 mb-12">Select a chapter below to begin your learning journey.</p>
                    <div id="chapters-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 text-left">
                        <!-- Chapter Blocks will be injected here by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ====================================================== -->
        <!-- Lecture Player Page -->
        <!-- ====================================================== -->
        <div id="lecture-page" class="page">
            <!-- Full-width, fixed video player section -->
            <div id="video-player-container" class="fixed top-0 left-0 w-full bg-black z-10">
                <video
                    id="lecture-video"
                    src="https://edtech.b-cdn.net/Phylum_Annelida_02.mp4"
                    style="width: 100%; height: 100%;"
                    controls
                    controlsList="nodownload"
                    autoplay
                    muted
                    playsinline
                >
                    Your browser does not support the video tag.
                </video>
            </div>
            
            <!-- Scrollable content area -->
            <div id="content-area" class="h-full overflow-y-auto">
                <!-- Centered content section below the player -->
                <div class="container mx-auto p-4 lg:p-8">
                    
                    <!-- Main content area -->
                    <div class="flex flex-col lg:flex-row lg:space-x-8">

                        <!-- Primary Content: Video details -->
                        <main class="w-full lg:w-2/3">
                            
                            <!-- Video Title -->
                            <h1 id="lecture-title" class="text-2xl md:text-3xl font-extrabold tracking-tight text-white mb-3 pt-4">
                                <!-- Title will be set by JS -->
                            </h1>
                            
                            <!-- Lecturer Info and Action Buttons -->
                            <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between pb-4 border-b border-slate-700">
                                <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                                    <img class="w-12 h-12 rounded-full object-cover" src="https://placehold.co/100x100/7e22ce/white?text=CT" alt="Lecturer Avatar">
                                    <div>
                                        <p class="text-lg font-bold text-white">Dr. Evelyn Reed</p>
                                        <p class="text-sm text-slate-400">1.2M Subscribers</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center space-x-2">
                                    <button class="flex items-center space-x-2 bg-slate-700 hover:bg-slate-600 transition-colors duration-200 rounded-full px-4 py-2 text-sm font-semibold">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a2 2 0 0 1 1.79 1.11L15 5.88Z"/></svg>
                                        <span>15K</span>
                                    </button>
                                    <button class="flex items-center space-x-2 bg-slate-700 hover:bg-slate-600 transition-colors duration-200 rounded-full px-4 py-2 text-sm font-semibold">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" x2="12" y1="2" y2="15"/></svg>
                                        <span>Share</span>
                                    </button>
                                    <button class="flex items-center space-x-2 bg-slate-700 hover:bg-slate-600 transition-colors duration-200 rounded-full px-4 py-2 text-sm font-semibold">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                                        <span>Module</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Lecture Description -->
                            <div class="mt-4 bg-slate-800 p-4 rounded-xl">
                                <p class="font-bold text-sm text-white mb-2">25,789 views • 2 days ago</p>
                                <div id="description-box" class="relative text-slate-300 text-sm leading-relaxed max-h-20 overflow-hidden transition-all duration-500 ease-in-out description-collapsed">
                                    <p id="lecture-description">
                                        <!-- Description will be set by JS -->
                                    </p>
                                </div>
                                <button id="toggle-description" class="font-bold text-sm mt-2 text-purple-400 hover:text-purple-300">Show more</button>
                            </div>
                        </main>

                        <!-- Secondary Content: Up Next Playlist -->
                        <aside class="w-full lg:w-1/3 mt-8 lg:mt-0">
                           <h2 class="text-xl font-bold mb-4 lg:pt-4">Up Next in this Course</h2>
                           <div class="space-y-3" id="up-next-playlist">
                               <!-- Playlist will be generated by JS -->
                           </div>
                        </aside>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB7t1epo6Vsi-zhjmFoYEkznUfmAoxfRyY",
            authDomain: "tutorup-dilshad.firebaseapp.com",
            databaseURL: "https://tutorup-dilshad-default-rtdb.firebaseio.com",
            projectId: "tutorup-dilshad",
            storageBucket: "tutorup-dilshad.appspot.com",
            messagingSenderId: "845385268581",
            appId: "1:845385268581:web:8af0729bd46012dc3a758c",
            measurementId: "G-XQE1WF1V63"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- DUMMY DATA FOR CHAPTERS ---
        const chapters = [
            { id: 1, title: "Introduction to Atomic Structure", description: "Explore the fundamental building blocks of matter, from protons and neutrons to electron shells.", videoUrl: "https://edtech.b-cdn.net/Phylum_Annelida_02.mp4", longDescription: "Dive deep into the atom! This chapter covers the historical models of the atom, the properties of subatomic particles, and how electron configurations determine chemical behavior. Essential for understanding bonding and reactivity." },
            { id: 2, title: "Chemical Bonding & Molecular Structure", description: "Learn about ionic, covalent, and metallic bonds that hold molecules and compounds together.", videoUrl: "https://edtech.b-cdn.net/VID-20230325-WA0000.mp4", longDescription: "Discover how atoms connect to form the world around us. We'll explore Lewis structures, VSEPR theory to predict molecular shapes, and the concepts of polarity and intermolecular forces which govern physical properties." },
            { id: 3, title: "States of Matter & Forces", description: "Understand the properties of solids, liquids, and gases and the forces that govern them.", videoUrl: "https://edtech.b-cdn.net/VID-20230325-WA0001.mp4", longDescription: "A comprehensive look at the states of matter. This chapter explains phase transitions, vapor pressure, and how intermolecular forces like hydrogen bonding and van der Waals forces influence boiling points and solubility." },
            { id: 4, title: "Chemical Reactions & Stoichiometry", description: "Master the art of balancing chemical equations and calculating reactant and product quantities.", videoUrl: "https://edtech.b-cdn.net/VID-20230325-WA0002.mp4", longDescription: "Stoichiometry is the quantitative heart of chemistry. Learn to balance equations, identify limiting reactants, and calculate theoretical and percent yields for chemical reactions. It's all about the numbers!" },
            { id: 5, title: "Thermodynamics in Chemistry", description: "Delve into energy, enthalpy, entropy, and Gibbs free energy in chemical processes.", videoUrl: "https://edtech.b-cdn.net/VID-20230325-WA0003.mp4", longDescription: "Explore the flow of energy in chemical reactions. This chapter introduces the laws of thermodynamics, explaining why some reactions are spontaneous and others are not, and how to calculate the heat absorbed or released." },
            { id: 6, title: "Organic Chemistry Fundamentals", description: "An introduction to the structure, properties, and reactions of carbon-based compounds.", videoUrl: "https://edtech.b-cdn.net/VID-20230325-WA0004.mp4", longDescription: "Begin your journey into the vast world of organic chemistry. This module covers nomenclature, functional groups, and the basic reaction types like substitution, addition, and elimination that form the basis of life and industry." }
        ];
        
        // --- PAGE NAVIGATION LOGIC ---
        const pages = document.querySelectorAll('.page');
        let navigationHistory = ['landing-page'];

        const showPage = (pageId) => {
            pages.forEach(page => page.classList.remove('active'));
            const activePage = document.getElementById(pageId);
            if (activePage) activePage.classList.add('active');
        };
        
        const navigateTo = (pageId) => {
            const currentPage = navigationHistory[navigationHistory.length - 1];
            if (pageId !== currentPage) {
                navigationHistory.push(pageId);
            }
            showPage(pageId);
        };
        
        const navigateBack = () => {
            if (navigationHistory.length > 1) {
                const currentPage = navigationHistory.pop();
                if (currentPage === 'chapters-page') {
                    signOut(auth); 
                }
                const previousPageId = navigationHistory[navigationHistory.length - 1];
                showPage(previousPageId);
            }
        };

        // --- GESTURE NAVIGATION ---
        const appContainer = document.getElementById('app-container');
        let touchStartX = 0;
        let touchStartY = 0;
        const edgeZone = 60; 

        appContainer.addEventListener('touchstart', e => {
            const touch = e.changedTouches[0];
            touchStartX = touch.screenX;
            touchStartY = touch.screenY;
        }, { passive: true });

        appContainer.addEventListener('touchend', e => {
            const touch = e.changedTouches[0];
            const touchEndX = touch.screenX;
            const touchEndY = touch.screenY;

            if ( navigationHistory.length > 1 && touchStartX < edgeZone && touchEndX > touchStartX + 70 && Math.abs(touchEndY - touchStartY) < Math.abs(touchEndX - touchStartX)) {
                navigateBack();
            }
        });

        // --- EVENT LISTENERS ---
        document.getElementById('get-started-btn').addEventListener('click', () => navigateTo('auth-page'));
        
        // --- AUTHENTICATION LOGIC ---
        const loginForm = document.getElementById('login-form');
        const authError = document.getElementById('auth-error');

        loginForm.addEventListener('submit', e => {
            e.preventDefault();
            const email = loginForm.email.value;
            const password = loginForm.password.value;
            authError.textContent = 'Signing in...';
            
            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    authError.textContent = '';
                    loginForm.reset();
                    navigateTo('chapters-page');
                })
                .catch(() => authError.textContent = 'Invalid email or password.');
        });
        
        onAuthStateChanged(auth, user => {
            const currentPage = navigationHistory[navigationHistory.length - 1];
            if (user && (currentPage === 'landing-page' || currentPage === 'auth-page')) {
                 navigateTo('chapters-page');
            } else if (!user && currentPage !== 'landing-page' && currentPage !== 'auth-page') {
                 navigationHistory = ['landing-page', 'auth-page'];
                 showPage('auth-page');
            }
        });
        
        // --- DYNAMIC CONTENT INJECTION (REVAMPED) ---
        const chaptersGrid = document.getElementById('chapters-grid');
        
        const populateChapters = () => {
            chaptersGrid.innerHTML = '';
            chapters.forEach(chapter => {
                const chapterEl = document.createElement('div');
                chapterEl.className = 'group bg-slate-800/60 backdrop-blur-md border border-slate-700 rounded-2xl overflow-hidden shadow-lg transition-all duration-300 hover:border-indigo-500/80 hover:shadow-indigo-500/20 hover:-translate-y-2 flex flex-col';
                chapterEl.innerHTML = `
                    <div class="relative overflow-hidden">
                        <img src="https://edtech.b-cdn.net/images%20(3).jpeg" alt="${chapter.title}" class="w-full h-48 object-cover transition-transform duration-500 ease-in-out group-hover:scale-110">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/90 to-transparent"></div>
                        <div class="absolute bottom-4 left-6">
                            <h3 class="text-xl font-bold text-white">${chapter.title}</h3>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <p class="text-slate-400 text-sm mb-4 flex-grow">${chapter.description}</p>
                        <button class="start-learning-btn w-full bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-3 px-4 rounded-lg transition-colors mt-8 shadow-lg shadow-indigo-600/20 hover:shadow-indigo-600/40" data-chapter-id="${chapter.id}">
                            Start Learning
                        </button>
                    </div>
                `;
                chaptersGrid.appendChild(chapterEl);
            });
            
            document.querySelectorAll('.start-learning-btn').forEach(button => {
                button.addEventListener('click', e => {
                    const chapterId = parseInt(e.currentTarget.dataset.chapterId, 10);
                    navigateTo('lecture-page');
                    setupLecturePage(chapterId);
                });
            });
        };

        // --- LECTURE PAGE LOGIC ---
        const lectureVideo = document.getElementById('lecture-video');
        const lectureTitle = document.getElementById('lecture-title');
        const lectureDescription = document.getElementById('lecture-description');
        const upNextPlaylist = document.getElementById('up-next-playlist');
        
        const setupLecturePage = (currentChapterId) => {
            const currentChapter = chapters.find(c => c.id === currentChapterId);
            const nextChapters = chapters.filter(c => c.id !== currentChapterId);

            lectureTitle.textContent = currentChapter.title;
            lectureDescription.textContent = currentChapter.longDescription;
            lectureVideo.src = currentChapter.videoUrl;
            lectureVideo.load();
            lectureVideo.play().catch(e => console.error("Autoplay was prevented:", e));
            resetDescriptionBox();
            upNextPlaylist.innerHTML = '';
            
             const currentItemEl = document.createElement('div');
             currentItemEl.className = 'flex space-x-3 bg-slate-800 p-2 rounded-lg ring-2 ring-purple-500';
             currentItemEl.innerHTML = `<div class="relative w-32 flex-shrink-0"><img class="w-full h-full object-cover rounded-md" src="https://placehold.co/400x225/1e293b/9ca3af?text=Now+Playing" alt="Video thumbnail"><div class="absolute inset-0 bg-black/50 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg></div></div><div><h3 class="font-semibold text-sm text-white leading-tight">${currentChapter.title}</h3><p class="text-xs text-slate-400 mt-1">Dr. Evelyn Reed</p></div>`;
             upNextPlaylist.appendChild(currentItemEl);

            nextChapters.forEach((chapter, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'flex space-x-3 hover:bg-slate-800/70 p-2 rounded-lg transition-colors duration-200 cursor-pointer playlist-item';
                itemEl.dataset.chapterId = chapter.id;
                itemEl.innerHTML = `<img class="w-32 object-cover rounded-md flex-shrink-0" src="https://placehold.co/400x225/1e293b/9ca3af?text=Lecture+${index+2}" alt="${chapter.title}"><div><h3 class="font-semibold text-sm text-white leading-tight">${chapter.title}</h3><p class="text-xs text-slate-400 mt-1">Dr. Evelyn Reed</p></div>`;
                upNextPlaylist.appendChild(itemEl);
            });
            
             upNextPlaylist.querySelectorAll('.playlist-item').forEach(button => {
                button.addEventListener('click', e => {
                    const chapterId = parseInt(e.currentTarget.dataset.chapterId, 10);
                    setupLecturePage(chapterId); 
                });
            });

            resizePlayer();
            document.getElementById('content-area').scrollTop = 0;
        };

        const playerContainer = document.getElementById('video-player-container');
        const contentArea = document.getElementById('content-area');

        function resizePlayer() {
            if (!document.getElementById('lecture-page').classList.contains('active')) return;
            const screenWidth = window.innerWidth;
            const playerHeight = screenWidth * 9 / 16;
            playerContainer.style.height = `${playerHeight}px`;
            contentArea.style.paddingTop = `${playerHeight}px`;
        }
        
        const toggleButton = document.getElementById('toggle-description');
        const descriptionBox = document.getElementById('description-box');

        const resetDescriptionBox = () => {
            descriptionBox.classList.remove('max-h-screen');
            descriptionBox.classList.add('max-h-20', 'description-collapsed');
            toggleButton.textContent = 'Show more';
        }

        toggleButton.addEventListener('click', () => {
            if (descriptionBox.classList.contains('max-h-screen')) {
                resetDescriptionBox();
            } else {
                descriptionBox.classList.remove('max-h-20', 'description-collapsed');
                descriptionBox.classList.add('max-h-screen');
                toggleButton.textContent = 'Show less';
            }
        });
        
        window.addEventListener('load', () => {
            populateChapters();
            resizePlayer();
        });
        window.addEventListener('resize', resizePlayer);

    </script>
</body>
</html>
