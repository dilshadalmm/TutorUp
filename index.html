<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimum-scale=1.0">
    <title>StudentPlus Static Solver</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts (Inter and Montserrat for the logo) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- KaTeX for LaTeX Rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/mhchem.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

    <style>
        /* CRITICAL: Ensure HTML and BODY are full height and non-scrollable */
        html {
            height: 100%;
            overflow: hidden !important;
        }

        /* Use the Inter font family as default */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            
            /* CRITICAL: Prevent the main body from scrolling at all */
            overflow: hidden !important; 
            
            user-select: none;
            -webkit-user-select: none; 
            -moz-user-select: none;
            -ms-user-select: none; 
            
            /* Prevents elastic scrolling on iOS */
            overscroll-behavior: none;
            
            /* Make body a fixed container occupying full screen */
            position: fixed;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        /* App wrapper - uses dynamic viewport height for mobile keyboard stability */
        #app-wrapper {
            height: 100vh; /* Fallback */
            height: 100dvh; /* Dynamic viewport height (best for mobile keyboard) */
            width: 100%;
            position: absolute; /* Relative to fixed body */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden; /* Ensures only the chat container can scroll */
        }
        
        /* Ensure input fields are still selectable/editable */
        #video-code-input, #message-input {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        /* Style for the logo font (Montserrat) */
        .instagram-logo-font {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.8rem;
        }

        /* Style for the Camera/Home buttons for a better touch target */
        .header-action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            transition: all 0.2s;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        
        /* Improve KaTeX readability on mobile */
        .katex {
            font-size: 1.1em !important;
            text-align: left !important;
        }
        .katex-display {
            /* Allow display math to be scrollable if too wide */
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 4px;
        }

        /* --- Hide Scrollbar on Chat Container --- */
        #chat-container {
            /* Scroll is now always auto (default of overflow-y-auto is active) */
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        #chat-container::-webkit-scrollbar {
            display: none;
        }

        /* Full-width Image Container Styles - MODIFIED: Remove rounded corners and side margins */
        .full-image-container {
            width: 100%;
            margin: 2px 0; /* REDUCED: Only top and bottom margin, reduced to 1/4th */
        }
        
        .full-image-item {
            width: 100%;
            border-radius: 0; /* REMOVED rounded corners */
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2px; /* REDUCED spacing between images */
        }
        
        .full-image-item:last-child {
            margin-bottom: 0; /* Remove margin from last image */
        }
        
        .full-image-item img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: contain;
        }

        /* Video Player Styles - MODIFIED: Remove rounded corners and side margins */
        .video-wrapper {
            position: relative;
            width: 100%;
            margin: 0 0 4px 0; /* REDUCED: Only bottom margin, no side margins, reduced to 1/4th */
            border-radius: 0; /* REMOVED rounded corners */
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .video-wrapper.chat-video-fullscreen {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) rotate(90deg) !important;
            transform-origin: center !important;
            width: 100vh !important;
            height: 100vw !important;
            max-width: none !important;
            max-height: none !important;
            z-index: 1000 !important;
            margin: 0 !important;
            border-radius: 0 !important;
        }

        .video-wrapper.chat-video-fullscreen .aspect-video {
            height: 100% !important;
            width: 100% !important;
        }

        .video-wrapper.chat-video-fullscreen iframe {
            height: 100% !important;
            width: 100% !important;
        }

        .fullscreen-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px;
            cursor: pointer;
            z-index: 10;
            transition: background 0.2s, opacity 0.3s ease;
        }

        .fullscreen-button.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .fullscreen-button:hover {
            background: rgba(0, 0, 0, 0.9);
        }

        /* Desktop responsive styles */
        @media (min-width: 768px) {
            #app-wrapper {
                position: relative;
                margin: 0 auto;
                max-width: 600px;
                height: 90vh;
                max-height: 800px;
                border-radius: 0.5rem;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
                top: 50%;
                transform: translateY(-50%);
            }
            
            #auth-wrapper {
                max-width: 500px;
                height: auto;
                max-height: 90vh;
                border-radius: 1rem;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            }
        }
        
        /* Loading indicator styles */
        .loading-spinner {
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Authentication page styles */
        #auth-wrapper {
            height: 100vh;
            height: 100dvh;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1.5rem;
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.3s ease;
            display: none; /* Hidden by default */
        }
        
        .auth-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        
        .auth-tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 0.75rem;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s;
            margin-top: 1rem;
        }
        
        .google-signin-btn:hover {
            background: #f9fafb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: #6b7280;
        }
        
        .divider::before, .divider::after {
            content: "";
            flex: 1;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .divider span {
            padding: 0 1rem;
            font-size: 0.875rem;
        }
        
        /* Auth home button */
        .auth-home-button {
            position: absolute;
            top: 1rem;
            left: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            padding: 0.5rem;
            color: white;
            transition: all 0.2s;
            z-index: 10;
        }
        
        .auth-home-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Initial message styles - MODIFIED: Remove rounded corners and side margins */
        .initial-message {
            text-align: center;
            color: #374151;
            padding: 8px 0; /* Only top and bottom padding, no side padding */
            font-size: 0.95rem;
            margin: 2px 0; /* REDUCED: Only top and bottom margin, reduced to 1/4th */
            line-height: 1.5;
            width: 100%;
            border-radius: 0; /* REMOVED rounded corners */
        }
        
        /* Navigation footer styles - UPDATED to match app background */
        .nav-footer {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: white;
            border-top: 1px solid #e5e7eb;
            padding: 4px 0; /* REDUCED vertical padding */
        }
        
        /* Dark mode support for footer */
        @media (prefers-color-scheme: dark) {
            .nav-footer {
                background: #1f2937; /* gray-800 */
                border-top: 1px solid #374151; /* gray-700 */
            }
        }
        
        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4px 12px; /* REDUCED vertical padding */
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #6b7280;
            transition: all 0.2s;
            cursor: pointer;
            flex: 1;
            max-width: 25%;
        }
        
        /* UPDATED: Navigation button active state with transparent background */
        .nav-button.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1); /* Blue with 10% opacity */
        }
        
        /* UPDATED: Remove white hover effect */
        .nav-button:hover {
            background: rgba(59, 130, 246, 0.05); /* Very subtle hover effect */
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 2px; /* REDUCED margin */
        }
        
        .nav-label {
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Update notification styles */
        .update-notification {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #3b82f6;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 20;
            display: none;
        }
        
        .update-date {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        /* REMOVED: Message status indicator (no longer needed) */
        
        /* Button transition styles */
        .button-transition {
            transition: all 0.2s ease-in-out;
        }

        /* Link detection styles - UPDATED for embedded media without message bubble */
        .message-link {
            color: #3b82f6;
            text-decoration: underline;
        }
        
        .embedded-media {
            max-width: 100%;
            border-radius: 0; /* REMOVED rounded corners */
            margin-top: 2px; /* REDUCED margin */
            margin-bottom: 2px; /* REDUCED margin */
        }
        
        .embedded-image {
            max-width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 0; /* REMOVED rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .embedded-video {
            width: 100%;
            max-height: 300px;
            border-radius: 0; /* REMOVED rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* YouTube embed in chat styles - MODIFIED: Remove rounded corners */
        .chat-youtube-embed {
            width: 100%;
            margin: 2px 0; /* REDUCED: Only vertical margins, reduced to 1/4th */
            border-radius: 0; /* REMOVED rounded corners */
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Description message bubble - MODIFIED: No rounded corners */
        .description-message {
            border-radius: 0 !important;
            margin-bottom: 2px !important; /* REDUCED margin */
        }
        
        /* Ensure no margin on last content element */
        #chat-container > *:last-child {
            margin-bottom: 0 !important;
        }
    </style>
</head>

<body class="h-full bg-gray-100 dark:bg-gray-900 flex items-center justify-center overflow-hidden">

    <!-- Authentication Page (Hidden by default) -->
    <div id="auth-wrapper" class="md:rounded-lg">
        <!-- Home Button on Auth Page -->
        <button id="auth-home-button" class="auth-home-button" aria-label="Go back to main page">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                <path d="M11.47 3.84a.75.75 0 0 1 1.06 0l8.69 8.69a1.5 1.5 0 0 1 .43 1.069V18a2.25 2.25 0 0 1-2.25 2.25h-5.25a.75.75 0 0 1-.75-.75V15c0-.621-.504-1.125-1.125-1.125h-2.25c-.621 0-1.125.504-1.125 1.125v4.5c0 .414-.336.75-.75.75H3.75A2.25 2.25 0 0 1 1.5 18v-4.401c0-.294.118-.578.325-.785l8.69-8.69Z" />
            </svg>
        </button>
        
        <div class="auth-card">
            <!-- Logo -->
            <div class="text-center mb-6">
                <h1 class="instagram-logo-font text-3xl inline-block bg-yellow-300 dark:bg-yellow-400 text-black dark:text-gray-900 px-4 py-2 rounded-lg">
                    StudentPlus
                </h1>
                <p class="text-gray-600 mt-2">Sign in to access the Solver</p>
            </div>
            
            <!-- Tabs -->
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="signin">Sign In</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <!-- Sign In Form -->
            <form id="signin-form" class="auth-form active">
                <div class="space-y-4">
                    <div>
                        <label for="signin-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input 
                            type="email" 
                            id="signin-email" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="your@email.com"
                        >
                    </div>
                    <div>
                        <label for="signin-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input 
                            type="password" 
                            id="signin-password" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="••••••••"
                        >
                    </div>
                    <button 
                        type="submit" 
                        id="signin-button"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center justify-center button-transition"
                    >
                        <span id="signin-button-text">Sign In</span>
                        <div id="signin-button-spinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </div>
                
                <div class="divider">
                    <span>Or continue with</span>
                </div>
                
                <button 
                    type="button" 
                    id="google-signin-button"
                    class="google-signin-btn button-transition"
                >
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Google
                </button>
            </form>
            
            <!-- Sign Up Form -->
            <form id="signup-form" class="auth-form">
                <div class="space-y-4">
                    <div>
                        <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input 
                            type="text" 
                            id="signup-name" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="John Doe"
                        >
                    </div>
                    <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input 
                            type="email" 
                            id="signup-email" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="your@email.com"
                        >
                    </div>
                    <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input 
                            type="password" 
                            id="signup-password" 
                            required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                            placeholder="••••••••"
                        >
                    </div>
                    <button 
                        type="submit" 
                        id="signup-button"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center justify-center button-transition"
                    >
                        <span id="signup-button-text">Create Account</span>
                        <div id="signup-button-spinner" class="loading-spinner ml-2 hidden"></div>
                    </button>
                </div>
                
                <div class="divider">
                    <span>Or continue with</span>
                </div>
                
                <button 
                    type="button" 
                    id="google-signup-button"
                    class="google-signin-btn button-transition"
                >
                    <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Google
                </button>
            </form>
        </div>
    </div>

    <!-- Mobile App Container (Flex Column) -->
    <div id="app-wrapper" class="bg-white dark:bg-gray-800 flex flex-col overflow-hidden rounded-none md:rounded-lg">

        <!-- Header - Fixed at top - MODIFIED: Reduced padding and spacing -->
        <header class="sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-2 shadow-sm flex flex-col space-y-2 flex-shrink-0">
            
            <!-- Top Row: Logo and Action Buttons -->
            <div class="flex items-center justify-between w-full">
                <!-- Title (with logo font) - MODIFIED: Both sides rounded corners -->
                <h1 class="text-xl flex-shrink-0 mr-4 ml-0">
                    <span class="instagram-logo-font bg-yellow-300 dark:bg-yellow-400 text-black dark:text-gray-900 px-3 py-1 rounded-md">StudentPlus</span>
                </h1>

                <!-- Action Buttons (Right End) -->
                <div class="flex items-center space-x-2 ml-auto">
                    <!-- Home Button -->
                    <button
                        type="button"
                        id="home-button"
                        class="header-action-button p-2 bg-green-500 hover:bg-green-600 text-white shadow-md focus:ring-2 focus:ring-green-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 button-transition"
                        aria-label="Go to Home/Clear Chat"
                    >
                        <!-- Home Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path d="M11.47 3.84a.75.75 0 0 1 1.06 0l8.69 8.69a1.5 1.5 0 0 1 .43 1.069V18a2.25 2.25 0 0 1-2.25 2.25h-5.25a.75.75 0 0 1-.75-.75V15c0-.621-.504-1.125-1.125-1.125h-2.25c-.621 0-1.125.504-1.125 1.125v4.5c0 .414-.336.75-.75.75H3.75A2.25 2.25 0 0 1 1.5 18v-4.401c0-.294.118-.578.325-.785l8.69-8.69Z" />
                        </svg>
                    </button>
                    
                    <!-- Login/Sign Out Button (Conditional) -->
                    <button
                        type="button"
                        id="auth-toggle-button"
                        class="header-action-button p-2 bg-blue-500 hover:bg-blue-600 text-white shadow-md focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 button-transition"
                        aria-label="Sign in or out"
                    >
                        <!-- Default login icon (will be updated based on auth state) -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                            <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 0 0 6 5.25v13.5a1.5 1.5 0 0 0 1.5 1.5h6a1.5 1.5 0 0 0 1.5-1.5V15a.75.75 0 0 1 1.5 0v3.75a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3V5.25a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3V9A.75.75 0 0 1 15 9V5.25a1.5 1.5 0 0 0-1.5-1.5h-6Zm5.03 4.72a.75.75 0 0 1 0 1.06l-1.72 1.72h10.94a.75.75 0 0 1 0 1.5H10.81l1.72 1.72a.75.75 0 1 1-1.06 1.06l-3-3a.75.75 0 0 1 0-1.06l3-3a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Bottom Row: Video Code Input -->
            <div class="flex w-full space-x-2">
                <input 
                    type="text" 
                    id="video-code-input"
                    placeholder="Enter video code (e.g., #56788)..."
                    class="flex-1 px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-blue-400"
                    autocomplete="off"
                >
                <!-- Send Button for Video Code (Blue) - Now uses a simple, robust Send Icon -->
                <button 
                    type="button"
                    id="go-button"
                    class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-md shadow-sm transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 flex-shrink-0 flex items-center justify-center button-transition"
                    aria-label="Load video code"
                >
                    <span id="go-button-text" class="flex items-center justify-center">
                        <!-- Simplified Send Icon (Paper Plane) - FIXED PATH -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path d="M2.01 21.01L23 12 2.01 3v7l15 2-15 2v7z" />
                        </svg>
                    </span>
                    <div id="go-button-spinner" class="loading-spinner ml-2 hidden"></div>
                </button>
            </div>
        </header>

        <!-- Chat Container - ONLY scrollable area (flex-1 overflow-y-auto) - MODIFIED: Remove side padding -->
        <main id="chat-container" class="flex-1 overflow-y-auto px-0 md:px-0">
            <!-- Initial content will be loaded here dynamically -->
        </main>

        <!-- Update Notification -->
        <div id="update-notification" class="update-notification hidden">
            <div id="notification-text"></div>
            <div id="notification-date" class="update-date"></div>
        </div>

        <!-- Navigation Footer - Fixed at bottom - MODIFIED: Reduced padding and spacing -->
        <footer class="sticky bottom-0 z-10 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 flex-shrink-0">
            <div class="nav-footer">
                <!-- Home Button -->
                <button id="nav-home" class="nav-button active" data-section="home">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="nav-icon">
                        <path d="M11.47 3.84a.75.75 0 0 1 1.06 0l8.69 8.69a1.5 1.5 0 0 1 .43 1.069V18a2.25 2.25 0 0 1-2.25 2.25h-5.25a.75.75 0 0 1-.75-.75V15c0-.621-.504-1.125-1.125-1.125h-2.25c-.621 0-1.125.504-1.125 1.125v4.5c0 .414-.336.75-.75.75H3.75A2.25 2.25 0 0 1 1.5 18v-4.401c0-.294.118-.578.325-.785l8.69-8.69Z" />
                    </svg>
                    <span class="nav-label">Home</span>
                </button>
                
                <!-- Message Button -->
                <button id="nav-message" class="nav-button" data-section="message">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="nav-icon">
                        <path fill-rule="evenodd" d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52 1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97a48.901 48.901 0 0 1-3.476.383.39.39 0 0 0-.297.17l-2.755 4.133a.75.75 0 0 1-1.248 0l-2.755-4.133a.39.39 0 0 0-.297-.17 48.9 48.9 0 0 1-3.476-.384c-1.978-.29-3.348-2.024-3.348-3.97V6.741c0-1.946 1.37-3.68 3.348-3.97ZM6.75 8.25a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H7.5Z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-label">Message</span>
                </button>
                
                <!-- Update Button -->
                <button id="nav-update" class="nav-button" data-section="update">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="nav-icon">
                        <path fill-rule="evenodd" d="M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-label">Update</span>
                </button>
                
                <!-- Course Button -->
                <button id="nav-course" class="nav-button" data-section="course">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="nav-icon">
                        <path d="M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 1 .707A8.237 8.237 0 0 1 6 18.75c1.995 0 3.823.707 5.25 1.886V4.533ZM12.75 20.636A8.214 8.214 0 0 1 18 18.75c.966 0 1.89.166 2.75.47a.75.75 0 0 0 1-.708V4.262a.75.75 0 0 0-.5-.707A9.735 9.735 0 0 0 18 3a9.707 9.707 0 0 0-5.25 1.533v16.103Z" />
                    </svg>
                    <span class="nav-label">Course</span>
                </button>
            </div>
        </footer>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBvZ8nYQKqXv3U6X3X3X3X3X3X3X3X3X3X3X3X",
            authDomain: "studentplus-static-solver.firebaseapp.com",
            projectId: "studentplus-static-solver",
            storageBucket: "studentplus-static-solver.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdefghijklmnopqrstuv"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let currentSection = 'home';
        let currentVideoCode = null;
        let currentScrollPosition = 0;

        // ==================== DOM ELEMENTS ====================
        const appWrapper = document.getElementById('app-wrapper');
        const authWrapper = document.getElementById('auth-wrapper');
        const authToggleButton = document.getElementById('auth-toggle-button');
        const authHomeButton = document.getElementById('auth-home-button');
        const chatContainer = document.getElementById('chat-container');
        const videoCodeInput = document.getElementById('video-code-input');
        const goButton = document.getElementById('go-button');
        const goButtonText = document.getElementById('go-button-text');
        const goButtonSpinner = document.getElementById('go-button-spinner');
        const homeButton = document.getElementById('home-button');
        const navButtons = document.querySelectorAll('.nav-button');
        const updateNotification = document.getElementById('update-notification');
        const notificationText = document.getElementById('notification-text');
        const notificationDate = document.getElementById('notification-date');

        // Authentication elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const signinForm = document.getElementById('signin-form');
        const signupForm = document.getElementById('signup-form');
        const signinButton = document.getElementById('signin-button');
        const signupButton = document.getElementById('signup-button');
        const signinButtonText = document.getElementById('signin-button-text');
        const signupButtonText = document.getElementById('signup-button-text');
        const signinButtonSpinner = document.getElementById('signin-button-spinner');
        const signupButtonSpinner = document.getElementById('signup-button-spinner');
        const googleSigninButton = document.getElementById('google-signin-button');
        const googleSignupButton = document.getElementById('google-signup-button');

        // ==================== AUTHENTICATION ====================
        // Auth state observer
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                // User is signed in
                updateAuthUI(true);
                showApp();
                loadCurrentSection();
            } else {
                // User is signed out
                updateAuthUI(false);
                showAuth();
            }
        });

        // Update authentication UI based on sign-in state
        function updateAuthUI(isSignedIn) {
            if (isSignedIn) {
                // Update auth toggle button to show sign out
                authToggleButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 0 0 6 5.25v13.5a1.5 1.5 0 0 0 1.5 1.5h6a1.5 1.5 0 0 0 1.5-1.5V15a.75.75 0 0 1 1.5 0v3.75a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3V5.25a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3V9A.75.75 0 0 1 15 9V5.25a1.5 1.5 0 0 0-1.5-1.5h-6Zm10.72 4.72a.75.75 0 0 1 1.06 0l3 3a.75.75 0 0 1 0 1.06l-3 3a.75.75 0 1 1-1.06-1.06l1.72-1.72H8.25a.75.75 0 0 1 0-1.5h12.19l-1.72-1.72a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                    </svg>
                `;
                authToggleButton.setAttribute('aria-label', 'Sign out');
            } else {
                // Update auth toggle button to show sign in
                authToggleButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 0 0 6 5.25v13.5a1.5 1.5 0 0 0 1.5 1.5h6a1.5 1.5 0 0 0 1.5-1.5V15a.75.75 0 0 1 1.5 0v3.75a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3V5.25a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3V9A.75.75 0 0 1 15 9V5.25a1.5 1.5 0 0 0-1.5-1.5h-6Zm5.03 4.72a.75.75 0 0 1 0 1.06l-1.72 1.72h10.94a.75.75 0 0 1 0 1.5H10.81l1.72 1.72a.75.75 0 1 1-1.06 1.06l-3-3a.75.75 0 0 1 0-1.06l3-3a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd" />
                    </svg>
                `;
                authToggleButton.setAttribute('aria-label', 'Sign in');
            }
        }

        // Show authentication page
        function showAuth() {
            authWrapper.style.display = 'flex';
            appWrapper.style.display = 'none';
        }

        // Show main app
        function showApp() {
            authWrapper.style.display = 'none';
            appWrapper.style.display = 'flex';
        }

        // Auth tab switching
        authTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                
                // Update active tab
                authTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show corresponding form
                authForms.forEach(form => {
                    form.classList.remove('active');
                    if (form.id === `${tabName}-form`) {
                        form.classList.add('active');
                    }
                });
            });
        });

        // Email/password sign in
        signinForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('signin-email').value;
            const password = document.getElementById('signin-password').value;
            
            // Show loading state
            signinButtonText.textContent = 'Signing In...';
            signinButtonSpinner.classList.remove('hidden');
            signinButton.disabled = true;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Success - handled by auth state change
                })
                .catch((error) => {
                    console.error('Sign in error:', error);
                    alert('Sign in failed: ' + error.message);
                    
                    // Reset button
                    signinButtonText.textContent = 'Sign In';
                    signinButtonSpinner.classList.add('hidden');
                    signinButton.disabled = false;
                });
        });

        // Email/password sign up
        signupForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            // Show loading state
            signupButtonText.textContent = 'Creating Account...';
            signupButtonSpinner.classList.remove('hidden');
            signupButton.disabled = true;
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Update user profile with name
                    return userCredential.user.updateProfile({
                        displayName: name
                    });
                })
                .then(() => {
                    // Success - handled by auth state change
                })
                .catch((error) => {
                    console.error('Sign up error:', error);
                    alert('Sign up failed: ' + error.message);
                    
                    // Reset button
                    signupButtonText.textContent = 'Create Account';
                    signupButtonSpinner.classList.add('hidden');
                    signupButton.disabled = false;
                });
        });

        // Google sign in
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            auth.signInWithPopup(provider)
                .then((result) => {
                    // Success - handled by auth state change
                })
                .catch((error) => {
                    console.error('Google sign in error:', error);
                    alert('Google sign in failed: ' + error.message);
                });
        }

        googleSigninButton.addEventListener('click', signInWithGoogle);
        googleSignupButton.addEventListener('click', signInWithGoogle);

        // Auth toggle (sign in/out)
        authToggleButton.addEventListener('click', () => {
            if (currentUser) {
                // Sign out
                auth.signOut()
                    .then(() => {
                        console.log('User signed out');
                    })
                    .catch((error) => {
                        console.error('Sign out error:', error);
                    });
            } else {
                // Show auth page
                showAuth();
            }
        });

        // Auth home button (go back to app)
        authHomeButton.addEventListener('click', () => {
            showApp();
        });

        // ==================== NAVIGATION ====================
        // Navigation button click handlers
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const section = button.getAttribute('data-section');
                switchSection(section);
            });
        });

        // Home button click handler
        homeButton.addEventListener('click', () => {
            switchSection('home');
        });

        // Switch between sections
        function switchSection(section) {
            // Save current scroll position before switching
            currentScrollPosition = chatContainer.scrollTop;
            
            // Update active nav button
            navButtons.forEach(button => {
                if (button.getAttribute('data-section') === section) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // Update current section
            currentSection = section;
            
            // Load section content
            loadCurrentSection();
            
            // Push new state to history
            history.pushState(
                { 
                    section: currentSection, 
                    videoCode: currentVideoCode,
                    scrollPosition: currentScrollPosition
                }, 
                '', 
                `#${currentSection}${currentVideoCode ? `-${currentVideoCode}` : ''}`
            );
        }

        // Load content for current section
        function loadCurrentSection() {
            // Clear chat container
            chatContainer.innerHTML = '';
            
            // Reset scroll position
            chatContainer.scrollTop = 0;
            
            switch(currentSection) {
                case 'home':
                    loadHomeContent();
                    break;
                case 'message':
                    loadMessageContent();
                    break;
                case 'update':
                    loadUpdateContent();
                    break;
                case 'course':
                    loadCourseContent();
                    break;
            }
        }

        // ==================== SECTION CONTENT LOADERS ====================
        // Load home content
        function loadHomeContent() {
            const initialMessage = document.createElement('div');
            initialMessage.className = 'initial-message';
            initialMessage.innerHTML = `
                <p>Welcome to StudentPlus Static Solver!</p>
                <p class="mt-2">Enter a video code above to get started.</p>
            `;
            chatContainer.appendChild(initialMessage);
        }

        // Load message content
        function loadMessageContent() {
            const messageContent = document.createElement('div');
            messageContent.className = 'p-4';
            messageContent.innerHTML = `
                <h2 class="text-lg font-semibold mb-2">Messages</h2>
                <p class="text-gray-600">Your messages will appear here.</p>
            `;
            chatContainer.appendChild(messageContent);
        }

        // Load update content
        function loadUpdateContent() {
            const updateContent = document.createElement('div');
            updateContent.className = 'p-4';
            updateContent.innerHTML = `
                <h2 class="text-lg font-semibold mb-2">Updates</h2>
                <p class="text-gray-600">Latest updates will appear here.</p>
            `;
            chatContainer.appendChild(updateContent);
        }

        // Load course content
        function loadCourseContent() {
            const courseContent = document.createElement('div');
            courseContent.className = 'p-4';
            courseContent.innerHTML = `
                <h2 class="text-lg font-semibold mb-2">Courses</h2>
                <p class="text-gray-600">Your courses will appear here.</p>
            `;
            chatContainer.appendChild(courseContent);
        }

        // ==================== VIDEO CODE HANDLING ====================
        // Go button click handler
        goButton.addEventListener('click', handleVideoCode);

        // Enter key in video code input
        videoCodeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleVideoCode();
            }
        });

        // Handle video code input
        function handleVideoCode() {
            const code = videoCodeInput.value.trim();
            
            if (!code) {
                alert('Please enter a video code');
                return;
            }
            
            // Extract code (remove # if present)
            const videoCode = code.replace('#', '');
            
            // Show loading state
            goButtonText.classList.add('hidden');
            goButtonSpinner.classList.remove('hidden');
            goButton.disabled = true;
            
            // Simulate API call (replace with actual implementation)
            setTimeout(() => {
                // Hide loading state
                goButtonText.classList.remove('hidden');
                goButtonSpinner.classList.add('hidden');
                goButton.disabled = false;
                
                // Clear input
                videoCodeInput.value = '';
                
                // Set current video code
                currentVideoCode = videoCode;
                
                // Load video content
                loadVideoContent(videoCode);
                
                // Push state to history
                history.pushState(
                    { 
                        section: currentSection, 
                        videoCode: currentVideoCode,
                        scrollPosition: chatContainer.scrollTop
                    }, 
                    '', 
                    `#${currentSection}-${currentVideoCode}`
                );
            }, 1000);
        }

        // Load video content
        function loadVideoContent(videoCode) {
            // Clear chat container
            chatContainer.innerHTML = '';
            
            // Add video content
            const videoContent = document.createElement('div');
            videoContent.className = 'p-4';
            videoContent.innerHTML = `
                <h2 class="text-lg font-semibold mb-2">Video #${videoCode}</h2>
                <p class="text-gray-600 mb-4">Content for video code ${videoCode} would be loaded here.</p>
                <div class="video-wrapper">
                    <div class="aspect-video bg-gray-200 flex items-center justify-center">
                        <p class="text-gray-500">Video Player for #${videoCode}</p>
                    </div>
                </div>
            `;
            chatContainer.appendChild(videoContent);
        }

        // ==================== HISTORY MANAGEMENT ====================
        // Initialize history state
        function initializeHistory() {
            // Set initial state
            history.replaceState(
                { 
                    section: 'home', 
                    videoCode: null,
                    scrollPosition: 0
                }, 
                '', 
                '#home'
            );
        }

        // Handle popstate event (back/forward navigation)
        window.addEventListener('popstate', (event) => {
            if (event.state) {
                // Restore previous state
                const { section, videoCode, scrollPosition } = event.state;
                
                // Update current section and video code
                currentSection = section || 'home';
                currentVideoCode = videoCode || null;
                
                // Update active nav button
                navButtons.forEach(button => {
                    if (button.getAttribute('data-section') === currentSection) {
                        button.classList.add('active');
                    } else {
                        button.classList.remove('active');
                    }
                });
                
                // Load appropriate content
                if (currentVideoCode) {
                    loadVideoContent(currentVideoCode);
                } else {
                    loadCurrentSection();
                }
                
                // Restore scroll position after a brief delay to allow content to render
                setTimeout(() => {
                    chatContainer.scrollTop = scrollPosition || 0;
                }, 50);
            }
        });

        // ==================== INITIALIZATION ====================
        // Initialize the app
        function initializeApp() {
            // Set up initial content
            loadHomeContent();
            
            // Initialize history management
            initializeHistory();
            
            // Check for updates (example implementation)
            checkForUpdates();
        }

        // Check for updates (example implementation)
        function checkForUpdates() {
            // This would typically check with a server for updates
            // For now, we'll simulate occasionally showing an update
            if (Math.random() > 0.7) {
                showUpdateNotification('New features available!', '2023-11-15');
            }
        }

        // Show update notification
        function showUpdateNotification(text, date) {
            notificationText.textContent = text;
            notificationDate.textContent = date;
            updateNotification.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                updateNotification.style.display = 'none';
            }, 5000);
        }

        // Close update notification when clicked
        updateNotification.addEventListener('click', () => {
            updateNotification.style.display = 'none';
        });

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);

        // ==================== ADDITIONAL ENHANCEMENTS ====================
        // Handle page visibility changes to preserve state
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // Page is visible again, we could restore any transient state here
            }
        });

        // Prevent default drag behaviors
        document.addEventListener('dragstart', (e) => {
            e.preventDefault();
        });

        // Handle potential resize issues on mobile
        window.addEventListener('resize', () => {
            // Ensure the app maintains proper dimensions
            chatContainer.style.height = '';
        });
    </script>
</body>
</html>
