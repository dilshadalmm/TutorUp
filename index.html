<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><title>TutorUp AI</title><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Poppins:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script><style>:root{--primary:#1a73e8;--primary-gradient:linear-gradient(135deg,#1a73e8 0%,#6c5ce7 100%);--primary-light:#e8f0fe;--text-primary:#202124;--text-secondary:#5f6368;--bg-color:#ffffff;--bg-secondary:#f8f9fa;--bg-tertiary:#f1f3f4;--border-color:#dadce0;--message-ai-bg:#f8f9fa;--message-user-bg:#e8f0fe;--code-bg:#282c34;--shadow:0 1px 3px rgba(0,0,0,0.08),0 1px 2px rgba(0,0,0,0.12);--shadow-hover:0 4px 12px rgba(0,0,0,0.1),0 2px 4px rgba(0,0,0,0.08);--radius:16px;--radius-small:8px;--app-height:100vh}.dark-theme{--primary:#8ab4f8;--primary-gradient:linear-gradient(135deg,#8ab4f8 0%,#a78bfa 100%);--primary-light:#1e3a5f;--text-primary:#e8eaed;--text-secondary:#9aa0a6;--bg-color:#000000;--bg-secondary:#1a1a1a;--bg-tertiary:#2a2a2a;--border-color:#333;--message-ai-bg:#1a1a1a;--message-user-bg:#1e3a5f;--code-bg:#2d2e30}*{margin:0;padding:0;box-sizing:border-box;transition:background-color 0.3s,color 0.3s,box-shadow 0.3s,transform 0.2s}body{height:var(--app-height);font-family:'Inter',sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none}pre,code{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}#login-page{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:20px}#login-page .login-container{width:100%;max-width:420px;background:white;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.2);overflow:hidden;animation:fadeIn 0.5s ease-out}@keyframes fadeIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}#login-page .login-header{background:#4f46e5;color:white;padding:40px 20px;text-align:center}#login-page .login-header h1{font-family:'Merriweather',serif;font-size:48px;font-weight:700;margin-bottom:5px;letter-spacing:-1px}#login-page .login-header p{font-size:16px;opacity:0.9;font-weight:400}#login-page .form-container{padding:40px 30px}#login-page .input-group{margin-bottom:25px;position:relative}#login-page .input-group label{display:block;margin-bottom:8px;font-weight:600;color:#374151;font-size:14px;font-family:'Poppins',sans-serif}#login-page .input-group input{width:100%;padding:14px 14px 14px 45px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;font-family:'Poppins',sans-serif;transition:all 0.3s ease}#login-page .input-group input:focus{border-color:#4f46e5;outline:none;box-shadow:0 0 0 4px rgba(79,70,229,0.1)}#login-page .input-group i{position:absolute;left:15px;top:45px;color:#9ca3af;font-size:18px;transition:color 0.3s ease}#login-page .input-group input:focus+i{color:#4f46e5}#login-page .btn{width:100%;padding:15px;background:#4f46e5;color:white;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s ease;display:flex;justify-content:center;align-items:center;gap:8px;font-family:'Poppins',sans-serif}#login-page .btn:hover{background:#4338ca;transform:translateY(-3px);box-shadow:0 7px 20px rgba(79,70,229,0.3)}#login-page .btn:disabled{background:#9ca3af;cursor:not-allowed;transform:none;box-shadow:none}#login-page .alert{padding:12px 16px;border-radius:10px;margin-top:20px;text-align:center;background:#fef2f2;border:1px solid #fecaca;color:#dc2626;font-size:14px;display:none}#login-page .loader{width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:white;animation:spin 1s ease-in-out infinite;display:none}@keyframes spin{to{transform:rotate(360deg)}}#chat-page{display:flex;flex-direction:column;height:100%;width:100%;overflow:hidden;background-color:var(--bg-color)}#chat-page .header{display:flex;justify-content:space-between;align-items:center;padding:12px 24px;border-bottom:1px solid var(--border-color);background-color:var(--bg-color);height:64px;flex-shrink:0}#chat-page .header-left{display:flex;align-items:center;gap:16px}#chat-page .menu-toggle{display:none;background:none;border:none;color:var(--text-secondary);font-size:24px;cursor:pointer}#chat-page .logo{display:flex;align-items:center;gap:12px;font-weight:700;font-size:22px;background:var(--primary-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-family:'Merriweather',serif}#chat-page .logo-icon{font-size:28px;background:var(--primary-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent}#chat-page .header-actions{display:flex;align-items:center;gap:12px}#chat-page .theme-toggle,#chat-page .logout-btn{background:none;border:1px solid var(--border-color);color:var(--text-secondary);cursor:pointer;font-size:16px;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center}#chat-page .theme-toggle:hover,#chat-page .logout-btn:hover{color:var(--primary);background-color:var(--bg-tertiary)}#chat-page .main{display:flex;flex:1;overflow:hidden}#chat-page .sidebar{width:320px;border-right:1px solid var(--border-color);background-color:var(--bg-secondary);padding:24px 0;display:flex;flex-direction:column;flex-shrink:0;transition:transform 0.3s ease-in-out}#chat-page .sidebar-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.4);z-index:99}#chat-page .new-chat-btn{margin:0 24px 24px;padding:14px 20px;background:var(--primary-gradient);color:white;border:none;border-radius:var(--radius);display:flex;align-items:center;gap:10px;cursor:pointer;font-weight:500}#chat-page .history-list{overflow-y:auto;flex:1}#chat-page .history-item{padding:14px 24px;cursor:pointer;display:flex;align-items:center;gap:12px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative}#chat-page .history-item:hover{background-color:var(--bg-tertiary)}#chat-page .history-item.active{background-color:var(--primary-light);color:var(--primary)}#chat-page .chat-container{flex:1;display:flex;flex-direction:column;overflow:hidden}#chat-page .chat-messages{flex:1;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:24px}#chat-page .message{display:flex;gap:16px;max-width:85%;animation:messageFadeIn 0.3s ease}@keyframes messageFadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}#chat-page .message-ai{align-self:flex-start}#chat-page .message-user{align-self:flex-end;flex-direction:row-reverse}#chat-page .avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}#chat-page .ai-avatar{background:var(--primary-gradient);color:white}#chat-page .user-msg-avatar{background:#6c5ce7;color:white}#chat-page .message-content{padding:18px;border-radius:var(--radius);line-height:1.6;background-color:var(--message-ai-bg);color:var(--text-primary);overflow-wrap:break-word;word-break:break-word}#chat-page .message-user .message-content{background-color:var(--message-user-bg)}#chat-page .message-content pre{position:relative;background-color:var(--code-bg);padding:16px;border-radius:var(--radius-small);overflow-x:auto;margin:12px 0;font-size:14px;color:#abb2bf}#chat-page .message-content pre .copy-btn{position:absolute;top:8px;right:8px;background:#4a4f58;border:1px solid #5f6368;color:#e8eaed;cursor:pointer;padding:4px 8px;border-radius:var(--radius-small);font-size:12px;opacity:0;transition:opacity 0.2s}#chat-page .message-content pre:hover .copy-btn{opacity:1}#chat-page .message-content p{margin:0}#chat-page .message-content p:not(:last-child){margin-bottom:1em}#chat-page .chat-input-container{padding:20px 24px;border-top:1px solid var(--border-color);background-color:var(--bg-color)}#chat-page .input-wrapper{display:flex;border:1px solid var(--border-color);border-radius:var(--radius);padding:8px 16px;background-color:var(--bg-color);align-items:center;gap:8px}#chat-page .input-wrapper:focus-within{border-color:var(--primary);box-shadow:0 0 0 2px var(--primary-light)}#chat-page .chat-input{flex:1;border:none;outline:none;padding:14px 0;background:transparent;color:var(--text-primary);resize:none;max-height:150px;font-size:16px}#chat-page .upload-btn,#chat-page .send-btn{background:var(--primary-gradient);border:none;color:white;cursor:pointer;font-size:14px;font-weight:500;width:44px;height:44px;border-radius:var(--radius-small);flex-shrink:0;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center}#chat-page .upload-btn{background:var(--bg-tertiary);color:var(--text-secondary);margin-right:4px}#chat-page .upload-btn:hover{background:var(--border-color)}#chat-page .send-btn:hover{box-shadow:var(--shadow-hover);transform:translateY(-1px)}#chat-page .send-btn:disabled{background:var(--bg-tertiary);cursor:not-allowed;transform:none;box-shadow:none;color:var(--text-secondary)}#chat-page .send-btn .fa-spinner{animation:spin 1s linear infinite}.context-menu{position:absolute;background:var(--bg-color);border-radius:var(--radius-small);box-shadow:var(--shadow-hover);z-index:1000;padding:8px 0;min-width:150px;display:none}.context-menu button{width:100%;text-align:left;padding:10px 16px;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:8px;color:var(--text-primary);font-size:14px}.context-menu button:hover{background-color:var(--bg-tertiary)}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;display:none}.modal{background:var(--bg-color);border-radius:var(--radius);padding:24px;width:90%;max-width:400px;box-shadow:var(--shadow-hover)}.modal h3{margin-bottom:16px;font-family:'Poppins',sans-serif}.modal-input{width:100%;padding:12px;border:1px solid var(--border-color);border-radius:var(--radius-small);margin-bottom:16px;font-family:'Inter',sans-serif}.modal-actions{display:flex;justify-content:flex-end;gap:12px}.modal-btn{padding:10px 20px;border-radius:var(--radius-small);border:none;cursor:pointer;font-weight:500}.modal-btn-primary{background:var(--primary);color:white}.modal-btn-secondary{background:var(--bg-tertiary);color:var(--text-secondary)}@media (max-width:768px){#chat-page .menu-toggle{display:block}#chat-page .sidebar{position:fixed;left:0;top:0;height:100%;z-index:100;transform:translateX(-100%);border-right:1px solid var(--border-color)}#chat-page .sidebar.active{transform:translateX(0);box-shadow:var(--shadow-hover)}#chat-page .sidebar-overlay.active{display:block}}</style></head><body><div id="login-page"><div class="login-container"><div class="login-header"><h1>TutorUp</h1><p>Please SignIn To Continue</p></div><div class="form-container"><form id="loginForm"><div class="input-group"><label for="loginEmail">Email</label><input type="email" id="loginEmail" placeholder="Enter your email" required><i class="fas fa-envelope"></i></div><div class="input-group"><label for="loginPassword">Password</label><input type="password" id="loginPassword" placeholder="Enter your password" required><i class="fas fa-lock"></i></div><button type="submit" class="btn" id="loginBtn"><div class="loader" id="loginLoader"></div><span id="loginBtnText">Sign In</span></button><div id="errorMessage" class="alert"></div></form></div></div></div><div id="chat-page" style="display:none"><header class="header"><div class="header-left"><button class="menu-toggle" id="menu-toggle" aria-label="Toggle Menu"><i class="fas fa-bars"></i></button><div class="logo"><i class="fas fa-brain logo-icon"></i><span>TutorUp</span></div></div><div class="header-actions"><button class="theme-toggle" id="theme-toggle" aria-label="Toggle Theme"><i class="fas fa-moon"></i></button><button class="logout-btn" id="logout-btn" aria-label="Logout"><i class="fas fa-sign-out-alt"></i></button></div></header><main class="main"><div class="sidebar-overlay" id="sidebar-overlay"></div><aside class="sidebar" id="sidebar"><button class="new-chat-btn" id="new-chat-btn"><i class="fas fa-plus"></i>New Chat</button><div class="history-list" id="history-list"></div></aside><section class="chat-container"><div class="chat-messages" id="chat-messages"></div><div class="chat-input-container"><div class="input-wrapper"><button class="upload-btn" id="upload-btn" aria-label="Upload file"><i class="fas fa-link"></i></button><textarea class="chat-input" id="chat-input" rows="1"></textarea><button class="send-btn" id="send-btn" aria-label="Send message"><i class="fas fa-paper-plane"></i></button></div></div></section></main></div><div class="context-menu" id="context-menu"><button id="rename-chat-btn"><i class="fas fa-edit"></i>Rename</button><button id="delete-chat-btn"><i class="fas fa-trash"></i>Delete</button></div><div class="modal-overlay" id="rename-modal"><div class="modal"><h3>Rename Chat</h3><input type="text" class="modal-input" id="rename-input" placeholder="Enter new chat name"><div class="modal-actions"><button class="modal-btn modal-btn-secondary" id="rename-cancel">Cancel</button><button class="modal-btn modal-btn-primary" id="rename-save">Save</button></div></div></div><script>!function(){const e={apiKey:"AIzaSyB7t1epo6Vsi-zhjmFoYEkznUfmAoxfRyY",authDomain:"tutorup-dilshad.firebaseapp.com",projectId:"tutorup-dilshad",storageBucket:"tutorup-dilshad.firebasestorage.app",messagingSenderId:"845385268581",appId:"1:845385268581:web:8af0729bd46012dc3a758c",measurementId:"G-XQE1WF1V63",databaseURL:"https://tutorup-dilshad-default-rtdb.firebaseio.com/"};firebase.initializeApp(e);const t=firebase.auth(),n=firebase.firestore(),o=firebase.storage();t.setPersistence(firebase.auth.Auth.Persistence.LOCAL);const i=document.getElementById("login-page"),a=document.getElementById("chat-page"),c=document.getElementById("loginForm"),d=document.getElementById("loginEmail"),s=document.getElementById("loginPassword"),l=document.getElementById("loginBtn"),r=document.getElementById("loginLoader"),m=document.getElementById("loginBtnText"),p=document.getElementById("errorMessage"),u=document.getElementById("chat-messages"),g=document.getElementById("chat-input"),h=document.getElementById("send-btn"),f=document.getElementById("upload-btn"),_=document.getElementById("theme-toggle"),v=document.getElementById("menu-toggle"),b=document.getElementById("sidebar"),y=document.getElementById("sidebar-overlay"),w=document.getElementById("new-chat-btn"),x=document.getElementById("logout-btn"),C=document.getElementById("history-list"),k=document.getElementById("context-menu"),T=document.getElementById("rename-modal"),E=document.getElementById("rename-input"),S=document.getElementById("rename-save"),A=document.getElementById("rename-cancel"),L=document.getElementById("rename-chat-btn"),O=document.getElementById("delete-chat-btn");let N=[],M=null,I=null,R=null,D=null,P=null,j=null;function U(e){l.disabled=e,r.style.display=e?"block":"none",m.textContent=e?"Signing In...":"Sign In"}function F(e){p.textContent=e,p.style.display="block"}d.addEventListener("input",()=>{p.style.display="none"}),s.addEventListener("input",()=>{p.style.display="none"});const B=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)};window.addEventListener("resize",B),B();_.addEventListener("click",()=>{document.body.classList.toggle("dark-theme"),a.classList.toggle("dark-theme"),_.innerHTML=document.body.classList.contains("dark-theme")?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>'}),v.addEventListener("click",()=>{b.classList.toggle("active"),y.classList.toggle("active")}),y.addEventListener("click",()=>{b.classList.toggle("active"),y.classList.toggle("active")}),g.addEventListener("input",function(){this.style.height="auto",this.style.height=`${this.scrollHeight}px`});const H=()=>{let e=localStorage.getItem("tutorup_session_id");return e||(e=`${Date.now()}_${Math.random().toString(36).slice(2)}`,localStorage.setItem("tutorup_session_id",e)),e},q=H();function V(){D&&(D(),D=null),P&&(P(),P=null),j&&(j(),j=null),M=null,N=[],C.innerHTML="",u.innerHTML=""}t.onAuthStateChanged(async e=>{if(e){I=e.uid,i.style.display="none",a.style.display="flex",document.body.style.background="var(--bg-color)",z(I),G(I)}else V(),I=null,a.style.display="none",i.style.display="flex",document.body.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}),t.currentUser&&(I=t.currentUser.uid,i.style.display="none",a.style.display="flex",document.body.style.background="var(--bg-color)",z(I),G(I));c.addEventListener("submit",e=>{e.preventDefault();const t=d.value.trim(),n=s.value.trim();if(!t||!n)return void F("Please enter both email and password.");U(!0),t.signInWithEmailAndPassword(t,n).catch(e=>{let t="An error occurred. Please try again.";switch(e.code){case"auth/invalid-email":case"auth/user-disabled":case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":t="Incorrect email or password."}F(t)}).finally(()=>{U(!1)})});async function z(e){try{const t=n.collection("activeSessions").doc(e);await t.set({sessionId:q,lastActive:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0}),j&&j(),j=t.onSnapshot(t=>{t.exists&&t.data().sessionId&&t.data().sessionId!==q&&(alert("You have been logged out because your account was opened on another device."),t.signOut())})}catch(e){console.error("Session tracking error:",e)}}function G(e){D&&D(),D=n.collection("chats").where("userId","==",e).orderBy("createdAt","desc").onSnapshot(e=>{C.innerHTML="",e.empty?W():e.forEach(e=>{const t=e.data();K(e.id,t.name||"New Chat")}),M||e.docs.length>0&&$(e.docs[0].id)},e=>{console.error("Error listening to chats:",e)})}function K(e,t){if(document.querySelector(`.history-item[data-chat-id="${e}"]`))return;const n=document.createElement("div");n.className="history-item",n.dataset.chatId=e,n.innerHTML=`<i class="fas fa-comment-dots"></i><span>${t}</span>`,n.addEventListener("click",()=>{$(e),b.classList.toggle("active"),y.classList.toggle("active")}),n.addEventListener("contextmenu",e=>{e.preventDefault(),R=e,Q(e)});let o;n.addEventListener("touchstart",e=>{o=setTimeout(()=>{e.preventDefault(),R=e,Q(e)},500)}),n.addEventListener("touchend",()=>{clearTimeout(o)}),C.appendChild(n)}function Q(e){k.style.display="block";let t=(e.pageX||e.touches&&e.touches[0].pageX||100),n=(e.pageY||e.touches&&e.touches[0].pageY||100);k.style.left=`${t}px`,k.style.top=`${n}px`;const o=e=>{k.contains(e.target)||(k.style.display="none",document.removeEventListener("click",o))};setTimeout(()=>document.addEventListener("click",o),0)}L.addEventListener("click",()=>{k.style.display="none",R||n.collection("chats").doc(R).get().then(e=>{e.exists&&(E.value=e.data().name||"",T.style.display="flex")}).catch(e=>{console.error("Error fetching chat for rename:",e)})}),O.addEventListener("click",()=>{k.style.display="none",R||confirm("Are you sure you want to delete this chat?")||n.collection("chats").doc(R).delete().then(()=>{const e=document.querySelector(`.history-item[data-chat-id="${R}"]`);e&&e.remove(),M===R&&(M=null,N=[],u.innerHTML="",W())}).catch(e=>{console.error("Error deleting chat:",e)})}),S.addEventListener("click",()=>{const e=E.value.trim();if(!e||!R)return;n.collection("chats").doc(R).update({name:e}).then(()=>{const t=document.querySelector(`.history-item[data-chat-id="${R}"] span`);t&&(t.textContent=e),T.style.display="none"}).catch(e=>{console.error("Error renaming chat:",e)})}),A.addEventListener("click",()=>{T.style.display="none"});function W(){if(!I)return void console.warn("Cannot create chat: user not set.");const e=`New Chat ${new Date().toLocaleTimeString()}`,t={userId:I,name:e,messages:[],createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()};n.collection("chats").add(t).then(t=>{K(t.id,e),$(t.id)}).catch(e=>{console.error("Error creating new chat:",e)})}w.addEventListener("click",W);function $(e){P&&P(),M=e,document.querySelectorAll(".history-item").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`.history-item[data-chat-id="${e}"]`);t&&t.classList.add("active"),P=n.collection("chats").doc(e).onSnapshot(e=>{if(!e.exists)return void(N=[],u.innerHTML="",M=null);const t=e.data();N=t.messages||[],X()},e=>{console.error("Error loading chat doc:",e)})}function X(){u.innerHTML="",N.forEach(e=>{const t=J(e);u.appendChild(t)}),u.scrollTop=u.scrollHeight}function J(e){const t=document.createElement("div");t.className="message "+(e.role==="user"?"message-user":"message-ai");const n=e.role==="user"?'<div class="avatar user-msg-avatar"><i class="fas fa-user"></i></div>':'<div class="avatar ai-avatar"><i class="fas fa-robot"></i></div>',o=`<div class="message-content">${marked.parse(e.text||"")}</div>`;return t.innerHTML=n+o,setTimeout(()=>{try{renderMathInElement(t,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})}catch(e){console.warn("KaTeX render error:",e)}},0),t}function Y(e){if(!M)return Promise.reject("No chat selected");const t={role:e.role,text:e.text,ts:Date.now()};return n.collection("chats").doc(M).update({messages:firebase.firestore.FieldValue.arrayUnion(t),updatedAt:firebase.firestore.FieldValue.serverTimestamp()})}function Z(e){M||(W(),setTimeout(()=>Z(e),600));const t={role:"user",text:e};N.push({role:t.role,text:t.text,ts:Date.now()}),u.appendChild(J(t)),u.scrollTop=u.scrollHeight,Y(t).catch(e=>{console.error("Error persisting user message:",e)})}function ee(e){if(!M)return void console.warn("No chat selected to add AI message");const t={role:"model",text:e};N.push({role:t.role,text:t.text,ts:Date.now()}),u.appendChild(J(t)),u.scrollTop=u.scrollHeight,Y({role:"model",text:e}).catch(e=>{console.error("Error persisting ai message:",e)})}h.addEventListener("click",te);const ne="YOUR_GEMINI_API_KEY";function te(){const e=g.value;if(!e||!e.trim())return;Z(e),g.value="",g.style.height="auto",h.disabled=!0,h.innerHTML='<i class="fas fa-spinner"></i>';const t={contents:[{parts:[{text:e}]}]};N.length>0&&(t.contents=N.map(e=>({role:e.role==="user"?"user":"model",parts:[{text:e.text}]})));fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${ne}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{try{const t=e?.candidates?.[0]?.content?.parts?.[0]?.text;t?ee(t):ee("Sorry, I couldn't generate a response right now.")}catch(e){console.error("Error parsing AI response:",e),ee("Sorry, I'm having trouble responding right now. Please try again later.")}}).catch(e=>{console.error("Error calling Gemini API:",e),ee("Sorry, I'm having trouble responding right now. Please try again later.")}).finally(()=>{h.disabled=!1,h.innerHTML='<i class="fas fa-paper-plane"></i>'})}const oe=document.createElement("input");oe.type="file",oe.accept="image/*,application/pdf,.doc,.docx,.ppt,.pptx,.txt",oe.capture="environment",oe.style.display="none",document.body.appendChild(oe),f.addEventListener("click",()=>{oe.click()}),oe.addEventListener("change",async e=>{const t=e.target.files[0];if(!t)return;if(!I||!M)return void alert("Please sign in and open a chat before uploading files.");const n=`uploads/${I}/${Date.now()}_${t.name.replace(/\s+/g,"_")}`,o=o.ref(n);Z(`Uploading ${t.name}...`);try{const e=await o.put(t),n=await o.getDownloadURL();t.type.startsWith("image/")?Z(`![](${n})`):Z(`[${t.name}](${n})`)}catch(e){console.error("File upload error:",e),ee("❌ File upload failed. Please try again.")}finally{oe.value=""}}),x.addEventListener("click",()=>{t.signOut().catch(e=>{console.error("Sign out error",e)})}),document.addEventListener("contextmenu",e=>{e.preventDefault();return!1}),document.addEventListener("keydown",e=>{(e.ctrlKey&&e.shiftKey&&73||e.ctrlKey&&e.shiftKey&&74||e.keyCode==123||e.ctrlKey&&e.keyCode==85)&&e.preventDefault()})}();</script></body></html>
