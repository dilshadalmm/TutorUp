<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Essential for mobile rendering -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoBazar - Mobile Grocery App (Dark Mode) with In-Memory Cart</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Dark Mode Base Background */
            background-color: #0d1117; /* bg-gray-950 equivalent for deep dark */
            color: #d1d5db; /* Default light text color (text-gray-300) */
            transition: background-color 0.3s ease; 
        }
        /* Disable scrolling when menu is open */
        .menu-open {
            overflow: hidden;
            height: 100vh;
        }
        /* Custom scrollbar style for horizontal category list/carousel */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Ensure the main content is viewable above the fixed bottom navigation */
        main {
            padding-bottom: 5rem !important; /* 80px, slightly more than the nav height, ensures buffer below last element */
        }
        /* Page views hidden by default, managed by JS */
        .page-view {
            display: none;
        }
        
        /* Styles for blur and pointer disablement when menu is open */
        .main-blur {
            /* Apply a visual darkening and slight blur effect to the main content */
            filter: blur(3px) brightness(0.7);
            pointer-events: none; /* Disable interaction with blurred content */
            transition: filter 0.3s ease;
        }
        
        /* Apply the blur/pointer-events to the main interactive containers */
        #main-content.main-blur, #app-header.main-blur {
            filter: blur(3px) brightness(0.7);
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    
    <!-- Header / App Bar (Fixed Top) -->
    <header id="app-header" class="sticky top-0 z-30 bg-gray-900 shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
            <div class="flex justify-between items-center h-16">
                
                <!-- Menu Toggle (Always prominent on mobile) -->
                <button id="menu-toggle" class="lg:hidden text-gray-200 cursor-pointer p-2 rounded-xl hover:bg-gray-800 transition">
                    <!-- Menu Icon (Hamburger) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                </button>

                <!-- Logo & Branding (Centered in Yellow Box) -->
                <a href="#" id="home-link-header" class="absolute left-1/2 transform -translate-x-1/2">
                    <div class="bg-yellow-400 px-3 py-1 rounded-lg shadow-xl border-2 border-yellow-300 transform transition-transform duration-150 active:scale-95">
                        <span class="text-2xl font-extrabold text-gray-900 leading-none">Geo<span class="text-blue-800">Bazar</span></span>
                    </div>
                </a>
                
                <!-- Action Icons (Order Tracking and Cart Count) -->
                <div class="flex items-center space-x-3">
                    
                    <!-- Order Tracking Button -->
                    <button id="track-order-header" class="text-gray-200 hover:text-blue-400 p-1 transition duration-150 transform active:scale-95">
                        <!-- Truck/Delivery Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 18H3c-1.1 0-2-.9-2-2V8c0-1.1.9-2 2-2h3"/><path d="M12 18H5V6h7l4 4v8"/><path d="M16 14h2l2 2v2h-4v-4zm-8 4v-4h4v4h-4z"/></svg>
                    </button>
                    
                    <!-- Cart Count Button (Now Functional) -->
                    <button id="cart-icon-header" class="text-gray-200 hover:text-green-400 relative p-1 transition duration-150 transform active:scale-95">
                        <!-- Shopping Cart Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.72a2 2 0 0 0 2-1.58L23 6H6"/></svg>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full ring-2 ring-gray-900">0</span>
                    </button>
                </div>
            </div>

            <!-- View Selector (Only shown on Home View) -->
            <div id="view-selector-container" class="p-2 -mt-1 pb-4">
                <div class="flex bg-gray-800 p-1 rounded-full shadow-inner border border-gray-700">
                    <!-- Wholesale Market Button (Active by default) -->
                    <button data-view="wholesale" 
                            class="view-switch-btn flex-1 py-2 rounded-full text-sm font-bold transition duration-200 
                                   bg-green-600 text-white shadow-xl transform active:scale-[0.98]">
                        Wholesale Market
                    </button>
                    <!-- Retailer Store Button (Inactive by default) -->
                    <button data-view="retailer" 
                            class="view-switch-btn flex-1 py-2 rounded-full text-sm font-bold transition duration-200 
                                   text-gray-300 hover:text-green-400">
                        Retailer Store
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Sidebar Backdrop Overlay (Covers all content when sidebar is open) -->
    <div id="sidebar-backdrop" 
         class="fixed inset-0 bg-black/60 z-30 opacity-0 pointer-events-none transition-opacity duration-300"
         aria-hidden="true" 
         style="display: none;">
    </div>


    <!-- Sidebar Menu (Overlay for Mobile/Desktop) -->
    <nav id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-gray-900 z-40 transform -translate-x-full transition-transform duration-300 shadow-2xl p-4 overflow-y-auto">
        
        <!-- Wholesalers Section Title (Modern Red Box - now "Main Suppliers") -->
        <div class="bg-red-800 border-2 border-red-500 p-3 rounded-xl shadow-xl mb-4 mt-4">
            <h3 class="text-lg font-extrabold text-white text-center whitespace-nowrap">Main Suppliers</h3>
        </div>
        
        <!-- Wholesaler Search Box -->
        <div class="mb-5">
            <div class="flex w-full shadow-inner rounded-xl bg-gray-700 border border-gray-600">
                <input type="text" placeholder="Search wholesalers..." 
                       class="w-full p-2 bg-transparent rounded-l-xl focus:ring-0 focus:border-transparent text-gray-100 placeholder:text-gray-400 text-sm">
                <button class="text-gray-300 p-2 rounded-r-xl hover:text-white transition duration-150">
                     <!-- Search Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                </button>
            </div>
        </div>
        
        <!-- Wholesaler List -->
        <div id="wholesaler-list" class="space-y-3">
            <!-- Wholesaler Cards injected by JS -->
        </div>
        
    </nav>

    <!-- Main Content Area -->
    <main id="main-content" class="flex-grow max-w-7xl mx-auto w-full px-4 pt-2 pb-4 sm:px-6 sm:pt-4 lg:px-8 lg:pt-4">
        
        <!-- WHOLESALE MARKET VIEW (HOME) -->
        <div id="wholesale-market-view" class="page-view">
            
            <!-- Shopping List Feature Card (Blue and prominent) -->
            <section class="mb-8">
                <div class="bg-blue-700 p-5 rounded-2xl shadow-xl text-white">
                    <h3 class="text-xl font-bold mb-1 flex items-center">
                        <span class="mr-3 text-3xl">üìù</span> Create a Shopping List
                    </h3>
                    <p class="text-blue-100 text-sm mb-4">
                        Plan your weekly shop, save items to your list, and add them to the cart later!
                    </p>
                    <button class="bg-green-400 text-blue-900 px-5 py-2 rounded-full font-bold text-sm hover:bg-green-500 transition duration-150 shadow-lg w-full transform active:scale-95">
                        Start Planning
                    </button>
                </div>
            </section>

            <!-- Latest Products Section (CAROUSEL) -->
            <section class="mb-8"> 
                <!-- STYLED HEADING: Top Deals Today (Swipe) -->
                <div class="flex items-center justify-center mb-4">
                    <!-- Left Line and Circle -->
                    <div class="flex items-center flex-grow">
                        <div class="h-0.5 w-full bg-red-600 rounded-full"></div>
                        <div class="w-2 h-2 bg-red-600 rounded-full -ml-1 flex-shrink-0"></div>
                    </div>

                    <!-- Title Box -->
                    <div class="bg-red-800 border-2 border-red-500 px-4 py-2 rounded-xl shadow-lg mx-2 flex-shrink-0">
                        <h2 class="text-lg font-extrabold text-white text-center whitespace-nowrap">Top Deals Today (Swipe)</h2>
                    </div>

                    <!-- Right Line and Circle -->
                    <div class="flex items-center flex-grow">
                        <div class="w-2 h-2 bg-red-600 rounded-full -mr-1 flex-shrink-0"></div>
                        <div class="h-0.5 w-full bg-red-600 rounded-full"></div>
                    </div>
                </div>
                <!-- END STYLED HEADING -->

                <!-- Horizontal scroll container for the carousel: GAP MATCHES GRID BELOW -->
                <div id="latest-products-grid" 
                     class="flex overflow-x-scroll space-x-4 pb-2 no-scrollbar snap-x snap-mandatory">
                    <!-- Product Cards injected by JS -->
                </div>
            </section>

            <!-- Featured Products Section (REMAINS ON HOME VIEW) -->
            <section class="mb-8">
                <!-- STYLED HEADING: Featured Essentials -->
                <div class="flex items-center justify-center mb-4">
                    <!-- Left Line and Circle -->
                    <div class="flex items-center flex-grow">
                        <div class="h-0.5 w-full bg-red-600 rounded-full"></div>
                        <div class="w-2 h-2 bg-red-600 rounded-full -ml-1 flex-shrink-0"></div>
                    </div>

                    <!-- Title Box -->
                    <div class="bg-red-800 border-2 border-red-500 px-4 py-2 rounded-xl shadow-lg mx-2 flex-shrink-0">
                        <h2 class="text-lg font-extrabold text-white text-center whitespace-nowrap">Featured Essentials</h2>
                    </div>

                    <!-- Right Line and Circle -->
                    <div class="flex items-center flex-grow">
                        <div class="w-2 h-2 bg-red-600 rounded-full -mr-1 flex-shrink-0"></div>
                        <div class="h-0.5 w-full bg-red-600 rounded-full"></div>
                    </div>
                </div>
                <!-- END STYLED HEADING -->

                <!-- Grid maintains grid-cols-2 and gap-4 -->
                <div id="featured-products-grid" class="grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6">
                    <!-- Product Cards injected by JS -->
                </div>
            </section>

            <!-- Manage Business Credit Card (Red Card Section) (REMAINS ON HOME VIEW) -->
            <section class="mb-4"> 
                <div class="bg-red-700 p-5 rounded-2xl shadow-xl text-white">
                    <h3 class="text-xl font-bold mb-1 flex items-center">
                        <span class="mr-3 text-3xl">üí∞</span> Manage Business Credit
                    </h3>
                    <p class="text-red-100 text-sm mb-4">
                        Track your payment cycles and credit limits with different wholesalers in one place.
                    </p>
                    <button class="bg-yellow-400 text-red-900 px-5 py-2 rounded-full font-bold text-sm hover:bg-yellow-500 transition duration-150 shadow-lg w-full transform active:scale-95">
                        View Credit Dashboard
                    </button>
                </div>
            </section>
            
        </div>
        
        <!-- CART REVIEW VIEW -->
        <div id="cart-view" class="page-view">
            
            <!-- Payment Method Selector (Capsule Style) - MOVED TO TOP -->
            <section class="p-2 -mt-1 pb-4">
                <div id="payment-method-selector" class="flex bg-gray-800 p-1 rounded-full shadow-inner border border-gray-700">
                    <button data-payment="esewa" 
                            class="payment-switch-btn flex-1 py-2 rounded-full text-sm font-bold transition duration-200 
                                   bg-green-600 text-white shadow-xl transform active:scale-[0.98]">
                        eSewa
                    </button>
                    <button data-payment="cod" 
                            class="payment-switch-btn flex-1 py-2 rounded-full text-sm font-bold transition duration-200 
                                   text-gray-300 hover:text-green-400">
                        Cash-On-Delivery
                    </button>
                </div>
            </section>

            <!-- Shopping List Feature Card (UPDATED TO YELLOW) -->
            <section class="mb-8">
                <div class="bg-yellow-500 p-5 rounded-2xl shadow-xl text-gray-900">
                    <h3 class="text-xl font-bold mb-1 flex items-center">
                        <span class="mr-3 text-3xl">üìù</span> Create a Shopping List
                    </h3>
                    <p class="text-gray-800 text-sm mb-4">
                        Plan your weekly shop, save items to your list, and add them to the cart later!
                    </p>
                    <button class="bg-red-700 text-white px-5 py-2 rounded-full font-bold text-sm hover:bg-red-800 transition duration-150 shadow-lg w-full transform active:scale-95">
                        Start Planning
                    </button>
                </div>
            </section>
            
            <!-- SECTION: Your Shopping Cart List -->
            <section class="mb-8">
                 <!-- STYLED HEADING: Your Shopping Cart (Review) -->
                <div class="flex items-center justify-center mb-4">
                    <div class="flex items-center flex-grow">
                        <div class="h-0.5 w-full bg-blue-600 rounded-full"></div>
                        <div class="w-2 h-2 bg-blue-600 rounded-full -ml-1 flex-shrink-0"></div>
                    </div>
                    <div class="bg-blue-800 border-2 border-blue-500 px-4 py-2 rounded-xl shadow-lg mx-2 flex-shrink-0">
                        <h2 class="text-lg font-extrabold text-white text-center whitespace-nowrap">Your Shopping Cart (Review)</h2>
                    </div>
                    <div class="flex items-center flex-grow">
                        <div class="w-2 h-2 bg-blue-600 rounded-full -mr-1 flex-shrink-0"></div>
                        <div class="h-0.5 w-full bg-blue-600 rounded-full"></div>
                    </div>
                </div>
                <!-- END STYLED HEADING -->

                <div id="cart-items-list" class="space-y-3">
                    <!-- Cart items will be rendered here -->
                    <div class="text-center text-gray-500 mt-8">Your cart is empty.</div>
                </div>
                
                <!-- Cart Summary and Checkout Button -->
                <div id="cart-summary-footer" class="bg-gray-800 p-4 rounded-xl shadow-lg mt-6">
                    <div class="space-y-2 border-b border-gray-700 pb-3 mb-3">
                        <div class="flex justify-between text-sm text-gray-300">
                            <span>Subtotal:</span>
                            <span id="subtotal-amount">NRs.0</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-300">
                            <span>Delivery Fee:</span>
                            <span id="delivery-fee-amount">NRs.0</span>
                        </div>
                    </div>
                    <div class="flex justify-between text-xl font-bold text-green-400">
                        <span>Total Payable:</span>
                        <span id="total-amount">NRs.0</span>
                    </div>
                    
                    <button id="checkout-button-cart" class="w-full bg-green-600 text-white py-3 mt-4 rounded-xl font-bold hover:bg-green-700 transition duration-150 transform active:scale-95 shadow-md">
                        Proceed to Checkout
                    </button>
                </div>
            </section>

        </div>

        <!-- ORDER TRACKING VIEW (Hidden by default) -->
        <div id="tracking-view" class="page-view">
            <h1 class="text-3xl font-extrabold text-gray-100 mb-6">Track Your Order</h1>

            <div class="bg-gray-800 p-6 rounded-2xl shadow-xl mb-6">
                <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-4">
                    <h3 class="text-xl font-bold text-gray-100">Order #349821</h3>
                    <span class="text-sm font-semibold text-green-400 bg-green-900 px-3 py-1 rounded-full">Out for Delivery</span>
                </div>
                
                <!-- Status Steps -->
                <ul class="space-y-4">
                    <li class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-green-600 text-white flex items-center justify-center mr-4 flex-shrink-0">‚úì</div>
                        <div>
                            <p class="font-semibold text-gray-100">Order Placed</p>
                            <p class="text-sm text-gray-400">Oct 4, 10:00 AM</p>
                        </div>
                    </li>
                    <li class="flex items-center relative">
                        <!-- Line connecting steps -->
                        <div class="absolute left-4 top-8 w-px h-10 bg-green-700"></div>
                        <div class="w-8 h-8 rounded-full bg-green-600 text-white flex items-center justify-center mr-4 flex-shrink-0">‚úì</div>
                        <div>
                            <p class="font-semibold text-gray-100">Processing & Packing</p>
                            <p class="text-sm text-gray-400">Oct 4, 11:30 AM</p>
                        </div>
                    </li>
                    <li class="flex items-center relative">
                        <div class="absolute left-4 top-8 w-px h-10 bg-yellow-600"></div>
                        <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center mr-4 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L8 16l-4-4"/></svg>
                        </div>
                        <div>
                            <p class="font-bold text-blue-400">Out for Delivery</p>
                            <p class="text-sm text-gray-400">Est. Arrival: Today, 3:00 PM</p>
                        </div>
                    </li>
                    <li class="flex items-center">
                        <div class="w-8 h-8 rounded-full border-2 border-gray-600 text-gray-500 flex items-center justify-center mr-4 flex-shrink-0">?</div>
                        <div>
                            <p class="font-semibold text-gray-500">Delivered</p>
                            <p class="text-sm text-gray-600">Awaiting Confirmation</p>
                        </div>
                    </li>
                </ul>
            </div>

            <button class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition duration-150 transform active:scale-95 shadow-md">
                Contact Delivery Agent
            </button>
        </div>
        
    </main>
    
    <!-- Bottom Navigation Bar (Fixed for App Feel) -->
    <nav id="bottom-nav" class="fixed bottom-0 left-0 right-0 z-50 bg-gray-900 border-t border-gray-700 shadow-[0_-5px_15px_-3px_rgba(0,0,0,0.3)] h-16">
        <div class="flex justify-around items-center h-full max-w-lg mx-auto">
            <!-- Home -->
            <button data-page="home" class="nav-btn flex flex-col items-center justify-center text-green-400 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span class="text-xs font-medium mt-0.5">Home</span>
            </button>
            <!-- Categories (Now opens sidebar/wholesalers) -->
            <button id="bottom-nav-categories" class="flex flex-col items-center justify-center text-gray-400 hover:text-green-400 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                <span class="text-xs font-medium mt-0.5">Wholesalers</span>
            </button>
            <!-- Cart (Central Action) -->
            <button data-page="cart" class="nav-btn flex flex-col items-center justify-center text-gray-400 hover:text-green-400 transition duration-150 relative">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.72a2 2 0 0 0 2-1.58L23 6H6"/></svg>
                <span class="text-xs font-medium mt-0.5">Cart</span>
                <span id="bottom-cart-count" class="absolute top-0 right-2 bg-red-600 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full">0</span>
            </button>
            <!-- Account/Profile -->
            <button data-page="account" class="nav-btn flex flex-col items-center justify-center text-gray-400 hover:text-green-400 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                <span class="text-xs font-medium mt-0.5">Account</span>
            </button>
        </div>
    </nav>


    <!-- JS for dynamic content and interactivity -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Global State & Data ---
            
            let cartItems = []; // Reverted to in-memory array

            const wholesalerData = [
                { id: 1, name: "Nepal Trading Co.", owner: "Rajesh Sharma", location: "Bhairahawa", rating: 4.8 },
                { id: 2, name: "Global Kirana Suppliers", owner: "Priya Tamang", location: "Kathmandu", rating: 4.5 },
                { id: 3, name: "Sunrise Provisions", owner: "Kiran Manandhar", location: "Biratnagar", rating: 4.9 },
                { id: 4, name: "Everest Distributors", owner: "Sita Rai", location: "Pokhara", rating: 4.7 },
                { id: 5, name: "Janta Wholesale Mart", owner: "Ajay Gupta", location: "Lalitpur", rating: 4.6 },
            ];

            const productData = [
                { id: 1, name: "Pearl Jeera Masino Rice, 25kg Bag", unitPrice: 2950, stockQuantity: 50, stockUnit: 'bags', skuId: '#001A1001' },
                { id: 2, name: "Rijal Agro Vinegar, 700ml Case (12 Pcs)", unitPrice: 85 * 12, stockQuantity: 20, stockUnit: 'cases', skuId: '#002B1002' },
                { id: 3, name: "MAGGI 2-minute Noodles, Case (100 Pcs)", unitPrice: 65 * 100, stockQuantity: 15, stockUnit: 'cases', skuId: '#003D1003' },
                { id: 4, name: "Kellogg's Muesli Fruit Magic, 500g (Bulk)", unitPrice: 799, stockQuantity: 0, stockUnit: 'boxes', skuId: '#004A1004' },
                { id: 5, name: "Whisper Ultra Soft XL Pad, Carton (24 Packs)", unitPrice: 450 * 24, stockQuantity: 10, stockUnit: 'cartons', skuId: '#005E1005' },
                { id: 6, name: "Gyan Premium Lito, 400gm Box (10 Packs)", unitPrice: 320 * 10, stockQuantity: 35, stockUnit: 'boxes', skuId: '#006A1006' },
                { id: 7, name: "Ramro SugarFree Cake, 200gm (Box of 8)", unitPrice: 150 * 8, stockQuantity: 0, stockUnit: 'boxes', skuId: '#007D1007' },
                { id: 8, name: "Tong Garden Wasabi Peas, 400gm Jar", unitPrice: 410, stockQuantity: 45, stockUnit: 'jars', skuId: '#008D1008' },
                { id: 9, name: "Bhansaghar Long Grain Rice, 20Kg Bag", unitPrice: 2100, stockQuantity: 60, stockUnit: 'bags', skuId: '#009A1009' },
                { id: 10, name: "Rijal Agro Soya Sauce, 350gm Carton (12)", unitPrice: 70 * 12, stockQuantity: 22, stockUnit: 'cartons', skuId: '#010B1010' },
                { id: 11, name: "Dummy Scroll WHOLESALE Item 1", unitPrice: 1000, stockQuantity: 99, stockUnit: 'units', skuId: '#011Z1011' },
                { id: 12, name: "Dummy Scroll WHOLESALE Item 2", unitPrice: 2000, stockQuantity: 99, stockUnit: 'units', skuId: '#012Z1012' },
                { id: 13, name: "Dummy Scroll WHOLESALE Item 3", unitPrice: 3000, stockQuantity: 99, stockUnit: 'units', skuId: '#013Z1013' },
                { id: 14, name: "Dummy Scroll WHOLESALE Item 4", unitPrice: 4000, stockQuantity: 99, stockUnit: 'units', skuId: '#014Z1014' },
                { id: 15, name: "Dummy Scroll WHOLESALE Item 5", unitPrice: 5000, stockQuantity: 99, stockUnit: 'units', skuId: '#015Z1015' },
            ];

            const retailerProductData = [
                { id: 101, name: "Pearl Jeera Masino Rice, 1kg Bag", unitPrice: 160, stockQuantity: 150, stockUnit: 'kg', skuId: '#001A2001' },
                { id: 102, name: "Rijal Agro Vinegar, 700ml Bottle", unitPrice: 105, stockQuantity: 50, stockUnit: 'bottles', skuId: '#002B2002' },
                { id: 103, name: "MAGGI 2-minute Noodles, Single Pack", unitPrice: 35, stockQuantity: 500, stockUnit: 'packs', skuId: '#003D2003' },
                { id: 104, name: "Kellogg's Muesli Fruit Magic, 100g Pouch", unitPrice: 299, stockQuantity: 0, stockUnit: 'pouches', skuId: '#004A2004' },
                { id: 105, name: "Whisper Ultra Soft XL Pad, Single Pack", unitPrice: 550, stockQuantity: 100, stockUnit: 'packs', skuId: '#005E2005' },
                { id: 106, name: "Gyan Premium Lito, 400gm Single Pack", unitPrice: 400, stockQuantity: 75, stockUnit: 'packs', skuId: '#006A2006' },
                { id: 107, name: "Ramro SugarFree Cake, 200gm (Box of 8)", unitPrice: 150 * 8, stockQuantity: 0, stockUnit: 'pieces', skuId: '#007D2007' },
                { id: 108, name: "Tong Garden Wasabi Peas, 100gm Pouch", unitPrice: 180, stockQuantity: 80, stockUnit: 'pouches', skuId: '#008D2008' },
                { id: 109, name: "Bhansaghar Long Grain Rice, 5Kg Bag", unitPrice: 750, stockQuantity: 30, stockUnit: 'bags', skuId: '#009A2009' },
                { id: 110, name: "Rijal Agro Soya Sauce, 350gm Bottle", unitPrice: 95, stockQuantity: 60, stockUnit: 'bottles', skuId: '#010B2010' },
                { id: 111, name: "Dummy Scroll RETAIL Item 1", unitPrice: 120, stockQuantity: 99, stockUnit: 'units', skuId: '#011Z2011' },
                { id: 112, name: "Dummy Scroll RETAIL Item 2", unitPrice: 210, stockQuantity: 99, stockUnit: 'units', skuId: '#012Z2012' },
                { id: 113, name: "Dummy Scroll RETAIL Item 3", unitPrice: 350, stockQuantity: 99, stockUnit: 'units', skuId: '#013Z2013' },
                { id: 114, name: "Dummy Scroll RETAIL Item 4", unitPrice: 410, stockQuantity: 99, stockUnit: 'units', skuId: '#014Z2014' },
                { id: 115, name: "Dummy Scroll RETAIL Item 5", unitPrice: 550, stockQuantity: 99, stockUnit: 'units', skuId: '#015Z2015' },
            ];
            
            const allProducts = productData.concat(retailerProductData);
            
            let currentPage = 'home';
            let currentProductView = 'wholesale'; // 'wholesale' or 'retailer'
            let currentPaymentMethod = 'esewa'; // 'esewa' or 'cod'
            let currentProductSet = productData; 
            const DELIVERY_FEE = 150;

            // --- DOM Elements ---
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const sidebarBackdrop = document.getElementById('sidebar-backdrop');
            const appHeader = document.getElementById('app-header');
            const mainContent = document.getElementById('main-content');
            const bottomNavCategories = document.getElementById('bottom-nav-categories');
            const wholesalerList = document.getElementById('wholesaler-list'); 
            
            const wholesaleMarketView = document.getElementById('wholesale-market-view');
            const latestProductsGrid = document.getElementById('latest-products-grid');
            const featuredProductsGrid = document.getElementById('featured-products-grid');
            const viewSelectorContainer = document.getElementById('view-selector-container');
            const viewSwitchBtns = document.querySelectorAll('.view-switch-btn');
            
            const cartCountElement = document.getElementById('cart-count');
            const bottomCartCountElement = document.getElementById('bottom-cart-count');
            
            const cartView = document.getElementById('cart-view');
            const trackingView = document.getElementById('tracking-view'); 
            
            const paymentSwitchBtns = document.querySelectorAll('.payment-switch-btn');
            const cartItemsList = document.getElementById('cart-items-list');

            // --- Core Logic Functions ---

            // Function to explicitly close the sidebar and remove blur
            const closeSidebar = () => { 
                if (!sidebar.classList.contains('-translate-x-full')) {
                    sidebar.classList.add('-translate-x-full');
                    
                    document.body.classList.remove('menu-open');
                    appHeader.classList.remove('main-blur');
                    mainContent.classList.remove('main-blur');
                    sidebarBackdrop.style.opacity = '0';
                    sidebarBackdrop.style.pointerEvents = 'none'; 
                    setTimeout(() => { sidebarBackdrop.style.display = 'none'; }, 300); 

                    bottomNavCategories.classList.remove('text-green-400');
                    bottomNavCategories.classList.add('text-gray-400');
                }
            }
            
            const switchProductView = (viewName) => {
                currentProductView = viewName;
                currentProductSet = (viewName === 'wholesale') ? productData : retailerProductData;

                viewSwitchBtns.forEach(btn => {
                    if (btn.getAttribute('data-view') === viewName) {
                        btn.classList.add('bg-green-600', 'text-white', 'shadow-xl');
                        btn.classList.remove('text-gray-300', 'hover:text-green-400');
                    } else {
                        btn.classList.remove('bg-green-600', 'text-white', 'shadow-xl');
                        btn.classList.add('text-gray-300', 'hover:text-green-400');
                    }
                });

                renderProducts(latestProductsGrid, currentProductSet.slice(0, 6), true); 
                renderProducts(featuredProductsGrid, currentProductSet.slice(4, 10));

                wholesaleMarketView.style.display = 'block';
            };
            
            const switchPaymentView = (paymentMethod) => {
                currentPaymentMethod = paymentMethod;

                paymentSwitchBtns.forEach(btn => {
                    if (btn.getAttribute('data-payment') === paymentMethod) {
                        btn.classList.add('bg-green-600', 'text-white', 'shadow-xl');
                        btn.classList.remove('text-gray-300', 'hover:text-green-400');
                    } else {
                        btn.classList.remove('bg-green-600', 'text-white', 'shadow-xl');
                        btn.classList.add('text-gray-300', 'hover:text-green-400');
                    }
                });
                showTemporaryMessage(`Payment Selected: ${paymentMethod === 'esewa' ? 'eSewa' : 'Cash-On-Delivery'}`);
            };

            const navigateTo = (page) => {
                closeSidebar();
                currentPage = page;
                
                document.querySelectorAll('.page-view').forEach(view => view.style.display = 'none');
                
                viewSelectorContainer.style.display = (page === 'home') ? 'block' : 'none';

                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('text-green-400');
                    btn.classList.add('text-gray-400');
                });

                if (page === 'home') {
                    switchProductView(currentProductView); 
                    document.querySelector(`[data-page="home"]`).classList.add('text-green-400');
                    document.querySelector(`[data-page="home"]`).classList.remove('text-gray-400');
                } else if (page === 'cart') {
                    renderCartItems();
                    switchPaymentView(currentPaymentMethod); 
                    cartView.style.display = 'block';
                    document.querySelector(`[data-page="cart"]`).classList.add('text-green-400');
                    document.querySelector(`[data-page="cart"]`).classList.remove('text-gray-400');
                } else if (page === 'tracking') {
                    trackingView.style.display = 'block';
                } else if (page === 'account') {
                    showTemporaryMessage("Account settings coming soon!");
                }
            };
            
            const calculateTotals = () => {
                const subtotal = cartItems.reduce((sum, item) => sum + (item.unitPrice * item.quantity), 0);
                const total = subtotal + DELIVERY_FEE;
                return { subtotal, total, deliveryFee: DELIVERY_FEE };
            };


            const updateCartCount = () => {
                // Calculate the total quantity of products
                const totalQuantity = cartItems.reduce((sum, item) => sum + item.quantity, 0);

                // Display the total quantity for better user context
                cartCountElement.textContent = totalQuantity;
                bottomCartCountElement.textContent = totalQuantity;
                
                // Re-render the Cart List and Home products if on relevant pages
                if (currentPage === 'cart') {
                    renderCartItems();
                } else if (currentPage === 'home') {
                    switchProductView(currentProductView); 
                }
            };

            // REVERTED: Removed 'unit' from cart item object
            const handleCartUpdate = (productId, action) => {
                
                const product = allProducts.find(p => p.id === productId);
                if (!product) return;
                
                const itemIndex = cartItems.findIndex(item => item.productId === productId);
                
                let successMessage = "";

                // --- HOME VIEW LOGIC (Single Add Enforcement) ---
                if (currentPage === 'home' && action === 'increment') {
                    if (itemIndex > -1) {
                        showTemporaryMessage(`${product.name.split(',')[0]} is already in cart. Adjust quantity on Cart Review page.`, 'warning');
                        return; 
                    }
                    
                    // Product not in cart, add once.
                    cartItems.push({ 
                        productId: productId, 
                        name: product.name, 
                        unitPrice: product.unitPrice, 
                        quantity: 1 // Always add 1
                    });
                    successMessage = `Added 1x of ${product.name.split(',')[0]} to cart!`;
                } 
                
                // --- CART VIEW LOGIC (Full Control for +, -, remove) ---
                else if (currentPage === 'cart') {
                    if (action === 'increment') {
                        if (itemIndex > -1) {
                            cartItems[itemIndex].quantity += 1;
                            successMessage = `Increased ${product.name.split(',')[0]} to ${cartItems[itemIndex].quantity}`;
                        }
                    } else if (action === 'decrement') {
                        if (itemIndex > -1) {
                            cartItems[itemIndex].quantity -= 1;
                            if (cartItems[itemIndex].quantity <= 0) {
                                cartItems.splice(itemIndex, 1); // Remove if quantity reaches 0
                                successMessage = `Removed ${product.name.split(',')[0]} from cart.`;
                            } else {
                                successMessage = `Decreased ${product.name.split(',')[0]} to ${cartItems[itemIndex].quantity}`;
                            }
                        }
                    } else if (action === 'remove') {
                        if (itemIndex > -1) {
                            cartItems.splice(itemIndex, 1);
                            successMessage = `Removed ${product.name.split(',')[0]} from cart.`;
                        }
                    }
                } 
                
                // Update UI after modifying local cartItems array
                updateCartCount();
                showTemporaryMessage(successMessage);
            };
            
            // RENDER HELPER: Creates the appropriate Cart Control 
            // REVERTED: Removed 'unit' parameter and unit display from HTML
            const renderCartControls = (productId, currentQuantity, isCartList = false) => {
                const product = allProducts.find(p => p.id === productId);
                if (!product) return '';
                const isInStock = product.stockQuantity > 0;
                
                // --- HOME VIEW LOGIC (isCartList = false) ---
                if (!isCartList) {
                    if (!isInStock) {
                         return `<button class="w-full py-2 text-sm font-bold rounded-lg bg-gray-600 text-gray-400 cursor-not-allowed" disabled>Sold Out</button>`;
                    }
                    
                    if (currentQuantity > 0) {
                        return `
                            <button data-product-id="${productId}" data-action="view-cart" class="home-nav-btn w-full py-2 text-sm font-bold rounded-lg bg-yellow-500 hover:bg-yellow-600 text-gray-900 transition duration-150 transform active:scale-95 shadow-md">
                                View in Cart
                            </button>
                        `;
                    }
                    
                    return `
                        <button data-product-id="${productId}" data-action="increment" class="cart-update-btn w-full py-2 text-sm font-bold rounded-lg bg-green-600 text-white hover:bg-green-700 transition duration-150 transform active:scale-95 shadow-md">
                            Add to Cart
                        </button>
                    `;
                }

                // --- CART REVIEW VIEW LOGIC (isCartList = true) ---
                
                const deleteButton = `
                    <button data-product-id="${productId}" data-action="remove" class="cart-update-btn bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg ml-2 transition duration-150 transform active:scale-90 shadow-md flex items-center justify-center min-w-[36px]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    </button>
                `; 
                
                return `
                    <div class="flex items-center w-full justify-end">
                        <div class="flex items-center bg-gray-700 rounded-lg p-0.5 shadow-inner flex-grow">
                            <button data-product-id="${productId}" data-action="decrement" class="cart-update-btn text-white bg-red-500 hover:bg-red-600 p-2 rounded-l-lg transition duration-150 transform active:scale-90 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/></svg>
                            </button>
                            <!-- REVERTED: Displaying quantity only -->
                            <span class="text-white font-bold text-sm mx-2 flex-grow text-center min-w-[30px]">${currentQuantity}</span>
                            <button data-product-id="${productId}" data-action="increment" class="cart-update-btn text-white bg-green-500 hover:bg-green-600 p-2 rounded-r-lg transition duration-150 transform active:scale-90 shadow-md">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                            </button>
                        </div>
                        ${deleteButton}
                    </div>
                `;
            };

            const createProductCard = (product, isCarousel = false) => {
                const cartItem = cartItems.find(item => item.productId === product.id);
                const currentQuantity = cartItem ? cartItem.quantity : 0;
                
                const marketType = product.skuId.charAt(5); 
                const tagColor = marketType === '1' ? 'bg-blue-600' : 'bg-red-600'; 

                const carouselClasses = isCarousel ? 'w-[calc(50%-0.5rem)] flex-shrink-0 snap-start' : 'flex-grow';

                return `
                    <div class="bg-gray-800 rounded-xl shadow-lg transition duration-300 overflow-hidden flex flex-col relative ${carouselClasses}">
                        <!-- Product ID Tag -->
                        <span class="absolute top-2 left-2 text-xs font-bold text-white px-2 py-0.5 rounded-full ${tagColor} shadow-md">
                            ${product.skuId}
                        </span>
                        
                        <!-- Placeholder Image/Icon -->
                        <div class="w-full h-32 bg-gray-700 flex items-center justify-center text-gray-400 text-xs p-2">
                            <span class="text-4xl text-green-400 font-extrabold">${product.name.split(' ')[0][0]}${product.name.split(' ')[1][0]}</span>
                        </div>
                        
                        <div class="p-3 flex-grow flex flex-col justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-100 text-sm mb-1 line-clamp-2" title="${product.name}">${product.name}</h3>
                                <p class="text-xl font-bold text-green-400">NRs.${product.unitPrice.toLocaleString()}</p>
                                
                                <div class="text-xs font-medium ${product.stockQuantity > 0 ? 'text-yellow-400' : 'text-red-500'} mb-3">
                                    Quantity: ${product.stockUnit}
                                </div>
                            </div>

                            <!-- Quantity Control Widget (Always 'Add to Cart' or 'View in Cart' for Home View) -->
                            ${renderCartControls(product.id, currentQuantity, false)}
                        </div>
                    </div>
                `;
            };

            const renderProducts = (element, products, isCarousel = false) => {
                element.innerHTML = products.map(product => createProductCard(product, isCarousel)).join('');
            };

            // REVERTED: Removed thumbnail and unit display logic
            const renderCartItems = () => {
                const { subtotal, total, deliveryFee } = calculateTotals();
                
                document.getElementById('subtotal-amount').textContent = `NRs.${subtotal.toLocaleString()}`;
                document.getElementById('delivery-fee-amount').textContent = `NRs.${deliveryFee.toLocaleString()}`;
                document.getElementById('total-amount').textContent = `NRs.${total.toLocaleString()}`;

                const cartSummaryFooter = document.getElementById('cart-summary-footer');

                if (cartItems.length === 0) {
                    cartItemsList.innerHTML = `<div class="bg-gray-800 p-4 rounded-xl text-center text-gray-400 font-medium">Your cart is empty. Start adding items from the Home page!</div>`;
                    cartSummaryFooter.style.display = 'none';
                    return;
                }

                cartSummaryFooter.style.display = 'block';

                cartItemsList.innerHTML = cartItems.map(item => {
                    const lineTotal = item.unitPrice * item.quantity;
                    
                    // REVERTED: Removed originalProduct lookup, marketColor, initials logic.

                    return `
                        <div class="bg-gray-800 p-3 rounded-xl shadow-lg flex items-start">
                            
                            <!-- Product Details (Left/Middle) - Now occupying full left side space -->
                            <div class="flex-grow min-w-0 pr-3">
                                <h4 class="font-bold text-gray-100 text-sm mb-1 line-clamp-2">${item.name}</h4>
                                <p class="text-xs text-gray-400">Unit Price: NRs.${item.unitPrice.toLocaleString()}</p>
                                <p class="text-sm font-semibold text-yellow-400 mt-1">Total: NRs.${lineTotal.toLocaleString()}</p>
                            </div>

                            <!-- Quantity & Delete Control (Right) -->
                            <div class="flex-shrink-0 pt-1">
                                <!-- REVERTED: Calling renderCartControls without the unit parameter -->
                                ${renderCartControls(item.productId, item.quantity, true)} 
                            </div>
                        </div>
                    `;
                }).join('');
            };


            // Wholesaler Rendering Function 
            const renderWholesalers = () => {
                wholesalerList.innerHTML = wholesalerData.map(wholesaler => {
                    const initials = wholesaler.owner.split(' ').map(n => n[0]).join('');

                    return `
                        <button class="w-full text-left">
                            <div class="bg-gray-800 p-3 rounded-xl shadow-md flex justify-between items-center hover:bg-gray-700 transition duration-150 active:scale-[0.98]">
                                <div class="flex-grow min-w-0 pr-3">
                                    <h4 class="font-bold text-gray-100 text-sm mb-0.5 truncate">${wholesaler.name}</h4>
                                    <p class="text-xs text-gray-400 flex items-center mb-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1 text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21.75c-4.418 0-8-3.582-8-8s8-16 8-16 8 11.582 8 16c0 4.418-3.582 8-8 8zm0-11a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5z"/></svg>
                                        ${wholesaler.location}
                                    </p>
                                    <p class="text-xs font-semibold text-yellow-400 flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 mr-1" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                        ${wholesaler.rating} Rating
                                    </p>
                                </div>
                                <div class="flex-shrink-0 w-16 h-12 bg-green-900 border-2 border-green-600 rounded-lg flex flex-col items-center justify-center text-white text-center shadow-lg p-1 ml-2">
                                    <span class="text-lg font-extrabold leading-none">${initials}</span>
                                    <span class="text-[9px] text-green-300 font-medium truncate w-full px-0.5">${wholesaler.owner}</span>
                                </div>
                            </div>
                        </button>
                    `;
                }).join('');
            };

            // --- Event Listeners and Handlers ---

            const toggleSidebar = () => {
                sidebar.classList.toggle('-translate-x-full');
                const isOpen = !sidebar.classList.contains('-translate-x-full');

                if (isOpen) {
                    document.body.classList.add('menu-open');
                    appHeader.classList.add('main-blur');
                    mainContent.classList.add('main-blur');
                    sidebarBackdrop.style.display = 'block'; 
                    setTimeout(() => { 
                        sidebarBackdrop.style.opacity = '1';
                        sidebarBackdrop.style.pointerEvents = 'auto'; 
                    }, 10); 
                    
                    bottomNavCategories.classList.remove('text-gray-400');
                    bottomNavCategories.classList.add('text-green-400');
                } else {
                    closeSidebar();
                }
            };

            menuToggle.addEventListener('click', toggleSidebar);
            bottomNavCategories.addEventListener('click', toggleSidebar);
            sidebarBackdrop.addEventListener('click', closeSidebar);
            
            const trackOrderHeaderBtn = document.getElementById('track-order-header');
            const cartIconHeader = document.getElementById('cart-icon-header');
            trackOrderHeaderBtn.addEventListener('click', () => navigateTo('tracking'));
            cartIconHeader.addEventListener('click', () => navigateTo('cart'));
            
            viewSwitchBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const view = btn.getAttribute('data-view');
                    if (currentPage === 'home') {
                        switchProductView(view);
                    }
                });
            });


            // Global Body Click Handler
            document.body.addEventListener('click', (e) => {
                
                // 1. Handle Cart State Update buttons (+, -, remove, Home 'Add to Cart') - uses .cart-update-btn
                const cartUpdateBtn = e.target.closest('.cart-update-btn');

                if (cartUpdateBtn) {
                    const productId = parseInt(cartUpdateBtn.getAttribute('data-product-id'));
                    const action = cartUpdateBtn.getAttribute('data-action');

                    // Check if the update is allowed and pass to the logic handler
                    if ((currentPage === 'cart' && ['increment', 'decrement', 'remove'].includes(action)) || 
                        (currentPage === 'home' && action === 'increment')) {
                        
                        handleCartUpdate(productId, action);
                        return;
                    }
                }
                
                // 2. Handle Home View navigation buttons ('View in Cart') - uses .home-nav-btn
                const homeViewBtn = e.target.closest('.home-nav-btn');
                if (homeViewBtn) {
                    const action = homeViewBtn.getAttribute('data-action');
                    
                    if (action === 'view-cart') {
                        navigateTo('cart');
                        return;
                    }
                }
                
                // 3. Handle Payment Method Selection
                const paymentBtn = e.target.closest('.payment-switch-btn');
                if (paymentBtn) {
                    const payment = paymentBtn.getAttribute('data-payment');
                    if (currentPage === 'cart') {
                        switchPaymentView(payment);
                    }
                }

                // 4. Handle Navigation Buttons
                const navBtn = e.target.closest('.nav-btn');
                if (navBtn) {
                    const page = navBtn.getAttribute('data-page');
                    if (page === 'home' || page === 'cart' || page === 'account') {
                        navigateTo(page);
                        return;
                    } else {
                        showTemporaryMessage(`Feature for '${page}' is coming soon!`);
                        return;
                    }
                }
                
                // 5. Handle Specific Links/Buttons
                if (e.target.closest('#home-link-header')) {
                    e.preventDefault();
                    navigateTo('home');
                    return;
                }
                if (e.target.id === 'checkout-button-cart') {
                    showTemporaryMessage(`Checking out with ${currentPaymentMethod}! Total: NRs.${calculateTotals().total.toLocaleString()}`);
                    return;
                }
            });

            // Temporary Message Box (Replaces alert())
            const showTemporaryMessage = (message, type = 'success') => {
                let msgBox = document.getElementById('temp-message-box');
                if (!msgBox) {
                    msgBox = document.createElement('div');
                    msgBox.id = 'temp-message-box';
                    msgBox.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 p-3 rounded-full shadow-2xl z-50 transition-all duration-300 opacity-0 text-sm font-semibold whitespace-nowrap';
                    document.body.appendChild(msgBox);
                }
                
                msgBox.textContent = message;
                msgBox.classList.remove('bg-gray-800', 'bg-red-700', 'bg-yellow-600');
                if (type === 'success') {
                    msgBox.classList.add('bg-gray-800', 'text-green-400');
                } else if (type === 'error') {
                    msgBox.classList.add('bg-red-700', 'text-white');
                } else if (type === 'warning') {
                     msgBox.classList.add('bg-yellow-600', 'text-gray-900');
                } else {
                    msgBox.classList.add('bg-gray-800', 'text-white');
                }
                
                msgBox.classList.remove('opacity-0', 'scale-90');
                msgBox.classList.add('opacity-100', 'scale-100');

                // Auto-hide after 1.5 seconds
                setTimeout(() => {
                    msgBox.classList.remove('opacity-100', 'scale-100');
                    msgBox.classList.add('opacity-0', 'scale-90');
                }, 1500);
            };

            // --- Initial Setup ---
            renderWholesalers();
            navigateTo('home');
        });
    </script>
</body>
</html>

