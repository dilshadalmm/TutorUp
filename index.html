<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Revision Tracker Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Prevent text selection and screen shaking */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        /* Allow text selection only in inputs and textareas */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Prevent screen shaking on scroll */
        html {
            overflow-x: hidden;
            margin-right: calc(-1 * (100vw - 100%));
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .image-modal {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
        }
        
        /* Smooth scrolling */
        .smooth-scroll {
            scroll-behavior: smooth;
        }
        
        /* Prevent horizontal scroll */
        .no-horizontal-scroll {
            max-width: 100vw;
            overflow-x: hidden;
        }
    </style>
</head>
<body class="antialiased no-horizontal-scroll">

    <div id="root"></div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDPOW80jLLyW9MXXqyMvD62-LM3VYj8qow",
            authDomain: "revision-tracker-pro-8d61a.firebaseapp.com",
            projectId: "revision-tracker-pro-8d61a",
            storageBucket: "revision-tracker-pro-8d61a.appspot.com",
            messagingSenderId: "336020028632",
            appId: "1:336020028632:web:19c3b341f5cd636b6d1a34"
        };
        
        const appId = "revision-tracker-pro-8d61a";
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js"></script>

    <script>
        // Initialize Firebase immediately
        try {
            const app = firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            
            // Enable offline persistence
            db.enablePersistence().catch(console.log);
            
            // Set globals
            window.firebaseApp = app;
            window.firebaseAuth = auth;
            window.firebaseDb = db;
            
            console.log('Firebase initialized successfully');
            
            // Signal ready
            window.dispatchEvent(new Event('firebase-ready'));
        } catch (error) {
            console.error('Firebase initialization failed:', error);
            // Create mock Firebase for fallback
            window.firebaseReady = true;
            window.firebaseError = error;
            window.dispatchEvent(new Event('firebase-ready'));
        }
    </script>

    <!-- React App -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // --- Icons ---
        const Icon = ({ path, className, fill = "none" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24" 
                fill={fill} 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />,
            Plus: (props) => <Icon {...props} path={<><path d="M5 12h14"/><path d="M12 5v14"/></>} />,
            CheckCircle2: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></>} />,
            Circle: (props) => <Icon {...props} path={<circle cx="12" cy="12" r="10"/>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></>} />,
            Trash2: (props) => <Icon {...props} path={<><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></>} />,
            LayoutDashboard: (props) => <Icon {...props} path={<><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></>} />,
            List: (props) => <Icon {...props} path={<><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></>} />,
            CalendarDays: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></>} />,
            Image: (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></>} />,
            X: (props) => <Icon {...props} path={<><path d="M18 6 6 18"/><path d="m6 6 12 12"/></>} />,
            TrendingUp: (props) => <Icon {...props} path={<><path d="m22 7-8.5 8.5-5-5L2 17"/><path d="M16 7h6v6"/></>} />,
            Clock: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>} />,
            Target: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></>} />,
            BarChart3: (props) => <Icon {...props} path={<><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></>} />,
            Zap: (props) => <Icon {...props} path={<path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z"/>} />,
            Eye: (props) => <Icon {...props} path={<><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></>} />,
        };

        // --- Helper Functions ---
        const getLocalDateString = (date = new Date()) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        const addDays = (dateStr, days) => {
            const date = new Date(dateStr);
            date.setDate(date.getDate() + days);
            return getLocalDateString(date);
        };

        const formatDateDisplay = (dateStr) => {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        };

        const getRevisionStatus = (targetDate, isCompleted) => {
            if (isCompleted) return 'completed';
            const today = getLocalDateString();
            if (targetDate === today) return 'due';
            if (targetDate < today) return 'missed';
            return 'future';
        };

        // --- Image Viewer Modal ---
        const ImageViewerModal = ({ imageUrl, onClose }) => {
            useEffect(() => {
                // Prevent body scroll when modal is open
                document.body.style.overflow = 'hidden';
                return () => {
                    document.body.style.overflow = 'auto';
                };
            }, []);

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/90 image-modal">
                    <div className="relative max-w-4xl max-h-[90vh] w-full">
                        <button
                            onClick={onClose}
                            className="absolute -top-12 right-0 text-white hover:text-gray-300 p-2"
                        >
                            <Icons.X className="w-6 h-6" />
                        </button>
                        <div className="bg-white rounded-lg overflow-hidden">
                            <img 
                                src={imageUrl} 
                                alt="Preview" 
                                className="w-full h-auto max-h-[70vh] object-contain"
                                onError={(e) => {
                                    e.target.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iI2YzZjRmNiIvPjx0ZXh0IHg9IjIwMCIgeT0iMTUwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiM2YzcyNzgiPkltYWdlIG5vdCBmb3VuZDwvdGV4dD48L3N2Zz4=';
                                }}
                            />
                            <div className="p-4 bg-gray-50">
                                <p className="text-sm text-gray-600 text-center">Click outside or X to close</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Confirmation Modal ---
        const ConfirmationModal = ({ isOpen, title, message, onConfirm, onCancel }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-40 bg-black/60 flex items-center justify-center p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 animate-fadeIn">
                        <div className="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <Icons.AlertCircle className="w-6 h-6 text-red-600" />
                        </div>
                        <h3 className="text-xl font-bold text-gray-800 text-center mb-2">{title}</h3>
                        <p className="text-gray-600 mb-6 text-center text-sm">{message}</p>
                        <div className="flex gap-3">
                            <button
                                onClick={onCancel}
                                className="flex-1 px-4 py-3 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all"
                            >
                                Cancel
                            </button>
                            <button
                                onClick={onConfirm}
                                className="flex-1 px-4 py-3 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-all"
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Revision Bubble Component ---
        const RevisionBubble = ({ label, date, status, onClick }) => {
            const styles = {
                completed: 'bg-green-100 text-green-700 border-green-200',
                due: 'bg-blue-100 text-blue-700 border-blue-400',
                missed: 'bg-red-100 text-red-700 border-red-200',
                future: 'bg-gray-50 text-gray-400 border-gray-200',
            };

            return (
                <div 
                    onClick={status !== 'future' ? onClick : undefined}
                    className={`flex flex-col items-center justify-center p-2 rounded-lg border w-full transition-all ${styles[status] || styles.future} ${status !== 'future' ? 'cursor-pointer active:scale-95' : ''}`}
                >
                    <span className="text-[10px] uppercase font-bold tracking-wider mb-1">{label}</span>
                    <div className="h-5 flex items-center justify-center">
                        {status === 'completed' ? <Icons.CheckCircle2 className="w-4 h-4" /> :
                        status === 'due' ? <Icons.Circle className="w-4 h-4 fill-blue-500 text-blue-600" /> :
                        status === 'missed' ? <Icons.AlertCircle className="w-4 h-4" /> :
                        <span className="text-[10px] font-medium">{formatDateDisplay(date).split(' ')[0]}</span>}
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [chapters, setChapters] = useState([]);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('dashboard');
            const [showAddForm, setShowAddForm] = useState(false);
            const [initialized, setInitialized] = useState(false);
            
            // Form state
            const [newChapterName, setNewChapterName] = useState('');
            const [studyDate, setStudyDate] = useState(getLocalDateString());
            const [newChapterImageUrl, setNewChapterImageUrl] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);
            
            // Modal states
            const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
            const [chapterToDelete, setChapterToDelete] = useState(null);
            const [viewingImage, setViewingImage] = useState(null);
            
            // Firebase refs
            const unsubscribeRef = useRef(null);

            // Initialize Firebase and load data
            useEffect(() => {
                let mounted = true;
                let authUnsubscribe = null;
                let dataUnsubscribe = null;

                const initializeApp = async () => {
                    try {
                        // Wait for Firebase to be ready
                        if (!window.firebaseDb) {
                            await new Promise(resolve => {
                                const checkFirebase = () => {
                                    if (window.firebaseDb) {
                                        resolve();
                                    } else {
                                        setTimeout(checkFirebase, 100);
                                    }
                                };
                                checkFirebase();
                            });
                        }

                        // Sign in anonymously
                        await window.firebaseAuth.signInAnonymously();
                        
                        const user = window.firebaseAuth.currentUser;
                        if (!user) {
                            throw new Error('Authentication failed');
                        }

                        // Set up real-time listener for user's chapters
                        const chaptersRef = window.firebaseDb
                            .collection('artifacts')
                            .doc(appId)
                            .collection('users')
                            .doc(user.uid)
                            .collection('chapters');

                        dataUnsubscribe = chaptersRef.onSnapshot(
                            (snapshot) => {
                                if (!mounted) return;
                                
                                const fetchedChapters = snapshot.docs.map(doc => ({
                                    id: doc.id,
                                    ...doc.data()
                                }));
                                
                                fetchedChapters.sort((a, b) => new Date(b.studyDate) - new Date(a.studyDate));
                                setChapters(fetchedChapters);
                                setLoading(false);
                                setInitialized(true);
                            },
                            (error) => {
                                console.error('Firestore error:', error);
                                if (mounted) {
                                    setLoading(false);
                                    setInitialized(true);
                                }
                            }
                        );

                        unsubscribeRef.current = dataUnsubscribe;

                    } catch (error) {
                        console.error('Initialization error:', error);
                        if (mounted) {
                            setLoading(false);
                            setInitialized(true);
                        }
                    }
                };

                // Start initialization
                initializeApp();

                // Cleanup function
                return () => {
                    mounted = false;
                    if (dataUnsubscribe) {
                        dataUnsubscribe();
                    }
                    if (authUnsubscribe) {
                        authUnsubscribe();
                    }
                };
            }, []);

            // Add Chapter Handler
            const handleAddChapter = async (e) => {
                e.preventDefault();
                
                if (!newChapterName.trim()) {
                    alert('Please enter a chapter name');
                    return;
                }

                setIsSubmitting(true);

                try {
                    // Create revision schedule
                    const schedule = {
                        d1: { date: addDays(studyDate, 1), completed: false },
                        d3: { date: addDays(studyDate, 3), completed: false },
                        d7: { date: addDays(studyDate, 7), completed: false },
                        d15: { date: addDays(studyDate, 15), completed: false },
                        d31: { date: addDays(studyDate, 31), completed: false },
                    };

                    const chapterData = {
                        name: newChapterName.trim(),
                        studyDate: studyDate,
                        imageUrl: newChapterImageUrl.trim() || null,
                        schedule: schedule,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    const user = window.firebaseAuth.currentUser;
                    if (!user) {
                        throw new Error('User not authenticated');
                    }

                    // Add to Firestore
                    await window.firebaseDb
                        .collection('artifacts')
                        .doc(appId)
                        .collection('users')
                        .doc(user.uid)
                        .collection('chapters')
                        .add(chapterData);

                    // Reset form
                    setNewChapterName('');
                    setNewChapterImageUrl('');
                    setStudyDate(getLocalDateString());
                    setShowAddForm(false);
                    
                } catch (error) {
                    console.error('Error adding chapter:', error);
                    alert('Failed to add chapter. Please try again.');
                } finally {
                    setIsSubmitting(false);
                }
            };

            // Toggle Revision Status
            const handleToggleRevision = async (chapterId, revisionKey, newValue) => {
                try {
                    const user = window.firebaseAuth.currentUser;
                    if (!user) return;

                    const chapterRef = window.firebaseDb
                        .collection('artifacts')
                        .doc(appId)
                        .collection('users')
                        .doc(user.uid)
                        .collection('chapters')
                        .doc(chapterId);

                    await chapterRef.update({
                        [`schedule.${revisionKey}.completed`]: newValue,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                } catch (error) {
                    console.error('Error updating revision:', error);
                }
            };

            // Delete Chapter
            const handleDeleteChapter = async () => {
                if (!chapterToDelete) return;

                try {
                    const user = window.firebaseAuth.currentUser;
                    if (!user) return;

                    await window.firebaseDb
                        .collection('artifacts')
                        .doc(appId)
                        .collection('users')
                        .doc(user.uid)
                        .collection('chapters')
                        .doc(chapterToDelete)
                        .delete();

                } catch (error) {
                    console.error('Error deleting chapter:', error);
                    alert('Failed to delete chapter');
                } finally {
                    setIsDeleteModalOpen(false);
                    setChapterToDelete(null);
                }
            };

            // Calculate statistics
            const todaysTasks = useMemo(() => {
                const today = getLocalDateString();
                const tasks = [];
                chapters.forEach(chapter => {
                    Object.entries(chapter.schedule || {}).forEach(([key, data]) => {
                        if (!data.completed && data.date <= today) {
                            tasks.push({ 
                                ...chapter, 
                                revisionType: key, 
                                revisionDate: data.date, 
                                status: data.date === today ? 'due' : 'missed' 
                            });
                        }
                    });
                });
                return tasks.sort((a, b) => new Date(a.revisionDate) - new Date(b.revisionDate));
            }, [chapters]);

            const stats = useMemo(() => {
                let completed = 0;
                let total = 0;
                chapters.forEach(c => {
                    Object.values(c.schedule || {}).forEach(s => {
                        total++;
                        if (s.completed) completed++;
                    });
                });
                return { 
                    completed, 
                    total,
                    percentage: total > 0 ? (completed / total) * 100 : 0
                };
            }, [chapters]);

            // Loading Screen
            if (!initialized) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4">
                        <div className="text-center">
                            <div className="relative mb-8">
                                <div className="w-20 h-20 border-4 border-white/20 rounded-full animate-spin"></div>
                                <div className="w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin absolute top-4 left-4"></div>
                                <Icons.BookOpen className="w-8 h-8 text-white absolute top-6 left-6" />
                            </div>
                            <h1 className="text-2xl font-bold text-white mb-2">Revision Tracker</h1>
                            <p className="text-white/80">Loading your study schedule...</p>
                            <div className="flex justify-center space-x-2 mt-4">
                                {[0, 1, 2].map(i => (
                                    <div
                                        key={i}
                                        className="w-2 h-2 bg-white rounded-full animate-pulse"
                                        style={{ animationDelay: `${i * 0.2}s` }}
                                    />
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // Main Render
            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 smooth-scroll">
                    {/* Image Viewer Modal */}
                    {viewingImage && (
                        <ImageViewerModal 
                            imageUrl={viewingImage}
                            onClose={() => setViewingImage(null)}
                        />
                    )}

                    {/* Delete Confirmation Modal */}
                    <ConfirmationModal
                        isOpen={isDeleteModalOpen}
                        title="Delete Chapter?"
                        message="This will permanently delete all revision data for this chapter. This action cannot be undone."
                        onConfirm={handleDeleteChapter}
                        onCancel={() => {
                            setIsDeleteModalOpen(false);
                            setChapterToDelete(null);
                        }}
                    />

                    {/* Fixed Header */}
                    <header className="gradient-bg text-white shadow-lg fixed-header">
                        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                                    <Icons.BookOpen className="w-6 h-6 text-white" />
                                </div>
                                <div>
                                    <h1 className="text-lg font-bold">Revision Tracker</h1>
                                    <p className="text-xs text-white/70">Stay organized, study smarter</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                <div className="hidden sm:block text-sm bg-white/10 px-3 py-1 rounded-full">
                                    {new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                                </div>
                                <button
                                    onClick={() => setShowAddForm(!showAddForm)}
                                    className="w-10 h-10 rounded-full bg-white text-blue-600 flex items-center justify-center hover:scale-105 transition-transform active:scale-95"
                                >
                                    {showAddForm ? <Icons.X className="w-5 h-5" /> : <Icons.Plus className="w-5 h-5" />}
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Main Content (with padding for fixed header) */}
                    <main className="max-w-6xl mx-auto px-4 pt-20 pb-8">
                        {/* Add Form */}
                        {showAddForm && (
                            <div className="glass-card rounded-xl p-5 mb-6 shadow-lg">
                                <h2 className="text-lg font-bold text-gray-800 mb-4">Add New Chapter</h2>
                                <form onSubmit={handleAddChapter} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Chapter Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={newChapterName}
                                            onChange={(e) => setNewChapterName(e.target.value)}
                                            placeholder="E.g., Organic Chemistry, Calculus II"
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                            required
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Study Date *
                                            </label>
                                            <div className="relative">
                                                <Icons.CalendarDays className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
                                                <input
                                                    type="date"
                                                    value={studyDate}
                                                    onChange={(e) => setStudyDate(e.target.value)}
                                                    className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                                    required
                                                />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                                Image URL (Optional)
                                            </label>
                                            <input
                                                type="url"
                                                value={newChapterImageUrl}
                                                onChange={(e) => setNewChapterImageUrl(e.target.value)}
                                                placeholder="https://example.com/image.jpg"
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="flex gap-3 pt-2">
                                        <button
                                            type="button"
                                            onClick={() => setShowAddForm(false)}
                                            className="px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            type="submit"
                                            disabled={isSubmitting || !newChapterName.trim()}
                                            className="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                        >
                                            {isSubmitting ? 'Adding...' : 'Add Chapter'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        {/* Stats Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div className="bg-white rounded-xl p-5 shadow">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <Icons.Target className="w-5 h-5 text-blue-600" />
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Overall Progress</p>
                                        <h3 className="text-2xl font-bold text-gray-800">{stats.completed}<span className="text-sm text-gray-400">/{stats.total}</span></h3>
                                    </div>
                                </div>
                                <div className="h-2 bg-gray-100 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full bg-blue-500 transition-all duration-500"
                                        style={{ width: `${stats.percentage}%` }}
                                    />
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-xl p-5 shadow">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                        <Icons.CheckCircle2 className="w-5 h-5 text-green-600" />
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Today's Tasks</p>
                                        <h3 className="text-2xl font-bold text-gray-800">{todaysTasks.length}</h3>
                                    </div>
                                </div>
                                <p className="text-sm text-gray-500">
                                    {todaysTasks.length === 0 ? 'All caught up!' : 'Need attention'}
                                </p>
                            </div>
                            
                            <div className="bg-white rounded-xl p-5 shadow">
                                <div className="flex items-center gap-3 mb-2">
                                    <div className="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                        <Icons.BookOpen className="w-5 h-5 text-purple-600" />
                                    </div>
                                    <div>
                                        <p className="text-sm text-gray-500">Active Chapters</p>
                                        <h3 className="text-2xl font-bold text-gray-800">{chapters.length}</h3>
                                    </div>
                                </div>
                                <p className="text-sm text-gray-500">
                                    {chapters.length === 0 ? 'Add your first chapter' : 'Total chapters'}
                                </p>
                            </div>
                        </div>

                        {/* Navigation */}
                        <div className="flex bg-white rounded-lg p-1 mb-6 shadow w-fit">
                            <button
                                onClick={() => setView('dashboard')}
                                className={`px-6 py-2 rounded-md transition-all ${view === 'dashboard' ? 'bg-blue-600 text-white shadow' : 'text-gray-600 hover:text-blue-600'}`}
                            >
                                Dashboard
                            </button>
                            <button
                                onClick={() => setView('schedule')}
                                className={`px-6 py-2 rounded-md transition-all ${view === 'schedule' ? 'bg-blue-600 text-white shadow' : 'text-gray-600 hover:text-blue-600'}`}
                            >
                                All Chapters
                            </button>
                        </div>

                        {/* Dashboard View */}
                        {view === 'dashboard' && (
                            <div className="space-y-4">
                                {todaysTasks.length === 0 ? (
                                    <div className="bg-white rounded-xl p-8 text-center shadow">
                                        <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <Icons.CheckCircle2 className="w-8 h-8 text-green-600" />
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-800 mb-2">All done for today!</h3>
                                        <p className="text-gray-500">No pending revisions. Great work!</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {todaysTasks.map((task) => (
                                            <div key={`${task.id}-${task.revisionType}`} className="bg-white rounded-xl p-4 shadow hover:shadow-md transition-shadow">
                                                <div className="flex items-center justify-between">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className="font-semibold text-gray-800">{task.name}</span>
                                                            <span className={`text-xs px-2 py-1 rounded-full ${task.revisionType === 'd1' ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-600'}`}>
                                                                {task.revisionType.toUpperCase()}
                                                            </span>
                                                            {task.status === 'missed' && (
                                                                <span className="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">
                                                                    Missed
                                                                </span>
                                                            )}
                                                        </div>
                                                        <p className="text-sm text-gray-500">
                                                            Studied: {formatDateDisplay(task.studyDate)}
                                                        </p>
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        {task.imageUrl && (
                                                            <button
                                                                onClick={() => setViewingImage(task.imageUrl)}
                                                                className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                                                title="View Image"
                                                            >
                                                                <Icons.Eye className="w-5 h-5" />
                                                            </button>
                                                        )}
                                                        <button
                                                            onClick={() => handleToggleRevision(task.id, task.revisionType, true)}
                                                            className="bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition-colors active:scale-95"
                                                        >
                                                            <Icons.CheckCircle2 className="w-5 h-5" />
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Schedule View */}
                        {view === 'schedule' && (
                            <div className="space-y-4">
                                {chapters.length === 0 ? (
                                    <div className="bg-white rounded-xl p-8 text-center shadow">
                                        <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <Icons.BookOpen className="w-8 h-8 text-blue-600" />
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-800 mb-2">No chapters yet</h3>
                                        <p className="text-gray-500 mb-4">Add your first chapter to start tracking</p>
                                        <button
                                            onClick={() => setShowAddForm(true)}
                                            className="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors"
                                        >
                                            Add First Chapter
                                        </button>
                                    </div>
                                ) : (
                                    chapters.map((chapter) => (
                                        <div key={chapter.id} className="bg-white rounded-xl p-4 shadow hover:shadow-md transition-shadow">
                                            <div className="flex items-start justify-between mb-4">
                                                <div className="flex-1">
                                                    <h3 className="font-semibold text-gray-800 mb-1">{chapter.name}</h3>
                                                    <div className="flex items-center gap-3">
                                                        <p className="text-sm text-gray-500">
                                                            Studied: {formatDateDisplay(chapter.studyDate)}
                                                        </p>
                                                        {chapter.imageUrl && (
                                                            <button
                                                                onClick={() => setViewingImage(chapter.imageUrl)}
                                                                className="text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1"
                                                            >
                                                                <Icons.Eye className="w-4 h-4" />
                                                                View Image
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => {
                                                        setChapterToDelete(chapter.id);
                                                        setIsDeleteModalOpen(true);
                                                    }}
                                                    className="p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                >
                                                    <Icons.Trash2 className="w-5 h-5" />
                                                </button>
                                            </div>
                                            
                                            <div className="grid grid-cols-5 gap-2">
                                                {['d1', 'd3', 'd7', 'd15', 'd31'].map((type) => {
                                                    const rev = chapter.schedule[type];
                                                    const status = getRevisionStatus(rev.date, rev.completed);
                                                    return (
                                                        <RevisionBubble 
                                                            key={type}
                                                            label={type}
                                                            date={rev.date}
                                                            status={status}
                                                            onClick={() => handleToggleRevision(chapter.id, type, !rev.completed)}
                                                        />
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        )}

                        {/* Footer Info */}
                        {chapters.length > 0 && (
                            <div className="mt-8 text-center">
                                <p className="text-sm text-gray-500">
                                    Real-time updates  {chapters.length} chapters  {stats.completed} revisions completed
                                </p>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
