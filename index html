<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>TutorUp AI</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Poppins:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><style>:root{--primary:#1a73e8;--primary-gradient:linear-gradient(135deg, #1a73e8 0%, #6c5ce7 100%);--primary-light:#e8f0fe;--text-primary:#202124;--text-secondary:#5f6368;--bg-color:#ffffff;--bg-secondary:#f8f9fa;--bg-tertiary:#f1f3f4;--border-color:#dadce0;--message-ai-bg:#f8f9fa;--message-user-bg:#e8f0fe;--code-bg:#282c34;--shadow:0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.12);--shadow-hover:0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.08);--radius:16px;--radius-small:8px;--app-height:100vh;}.dark-theme{--primary:#8ab4f8;--primary-gradient:linear-gradient(135deg, #8ab4f8 0%, #a78bfa 100%);--primary-light:#1e3a5f;--text-primary:#e8eaed;--text-secondary:#9aa0a6;--bg-color:#000000;--bg-secondary:#1e1e1e;--bg-tertiary:#2c2c2c;--border-color:#5f6368;--message-ai-bg:#303134;--message-user-bg:#1e3a5f;--code-bg:#2d2e30;}*{margin:0;padding:0;box-sizing:border-box;transition:background-color .3s, color .3s, box-shadow .3s, transform .2s;}body{height:var(--app-height);font-family:'Inter',sans-serif;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-touch-callout:none;}pre,code{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;}#login-page{display:flex;justify-content:center;align-items:center;width:100%;height:100%;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);padding:20px;position:absolute;top:0;left:0;z-index:10;}#login-page .login-container{width:100%;max-width:420px;background:white;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,0.2);overflow:hidden;animation:fadeIn .5s ease-out;}@keyframes fadeIn{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}#login-page .login-header{background:#4f46e5;color:white;padding:40px 20px;text-align:center;}#login-page .login-header h1{font-family:'Merriweather',serif;font-size:48px;font-weight:700;margin-bottom:5px;letter-spacing:-1px;}#login-page .login-header p{font-size:16px;opacity:0.9;font-weight:400;}#login-page .form-container{padding:40px 30px;}#login-page .input-group{margin-bottom:25px;position:relative;}#login-page .input-group label{display:block;margin-bottom:8px;font-weight:600;color:#374151;font-size:14px;font-family:'Poppins',sans-serif;}#login-page .input-group input{width:100%;padding:14px 14px 14px 45px;border:2px solid #e5e7eb;border-radius:12px;font-size:16px;font-family:'Poppins',sans-serif;transition:all .3s ease;}#login-page .input-group input:focus{border-color:#4f46e5;outline:none;box-shadow:0 0 0 4px rgba(79,70,229,0.1);}#login-page .input-group i{position:absolute;left:15px;top:45px;color:#9ca3af;font-size:18px;transition:color .3s ease;}#login-page .input-group input:focus + i{color:#4f46e5;}#login-page .btn{width:100%;padding:15px;background:#4f46e5;color:white;border:none;border-radius:12px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;display:flex;justify-content:center;align-items:center;gap:8px;font-family:'Poppins',sans-serif;}#login-page .btn:hover{background:#4338ca;transform:translateY(-3px);box-shadow:0 7px 20px rgba(79,70,229,0.3);}#login-page .btn:disabled{background:#9ca3af;cursor:not-allowed;transform:none;box-shadow:none;}#login-page .alert{padding:12px 16px;border-radius:10px;margin-top:20px;text-align:center;background:#fef2f2;border:1px solid #fecaca;color:#dc2626;font-size:14px;display:none;}#login-page .loader{width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:white;animation:spin 1s ease-in-out infinite;display:none;}@keyframes spin{to{transform:rotate(360deg);}}#chat-page{display:flex;flex-direction:column;height:100%;width:100%;overflow:hidden;background-color:var(--bg-color);}#chat-page .header{display:flex;justify-content:space-between;align-items:center;padding:12px 24px;border-bottom:1px solid var(--border-color);background-color:var(--bg-color);height:64px;flex-shrink:0;}#chat-page .header-left{display:flex;align-items:center;gap:16px;}#chat-page .menu-toggle{display:none;background:none;border:none;color:var(--text-secondary);font-size:24px;cursor:pointer;}#chat-page .logo{display:flex;align-items:center;gap:12px;font-weight:700;font-size:22px;background:var(--primary-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-family:'Merriweather',serif;}#chat-page .logo-icon{font-size:28px;background:var(--primary-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}#chat-page .header-actions{display:flex;align-items:center;gap:12px;}#chat-page .theme-toggle,#chat-page .logout-btn{background:none;border:1px solid var(--border-color);color:var(--text-secondary);cursor:pointer;font-size:16px;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;}#chat-page .theme-toggle:hover,#chat-page .logout-btn:hover{color:var(--primary);background-color:var(--bg-tertiary);}#chat-page .main{display:flex;flex:1;overflow:hidden;}#chat-page .sidebar{width:320px;border-right:1px solid var(--border-color);background-color:var(--bg-secondary);padding:24px 0;display:flex;flex-direction:column;flex-shrink:0;transition:transform .3s ease-in-out;}#chat-page .sidebar-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.4);z-index:99;}#chat-page .new-chat-btn{margin:0 24px 24px;padding:14px 20px;background:var(--primary-gradient);color:white;border:none;border-radius:var(--radius);display:flex;align-items:center;gap:10px;cursor:pointer;font-weight:500;}#chat-page .history-list{overflow-y:auto;flex:1;}#chat-page .history-item{padding:14px 24px;cursor:pointer;display:flex;align-items:center;gap:12px;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;position:relative;}#chat-page .history-item:hover{background-color:var(--bg-tertiary);}#chat-page .history-item.active{background-color:var(--primary-light);color:var(--primary);}#chat-page .chat-container{flex:1;display:flex;flex-direction:column;overflow:hidden;}#chat-page .chat-messages{flex:1;padding:24px;overflow-y:auto;display:flex;flex-direction:column;gap:24px;}#chat-page .message{display:flex;gap:16px;max-width:85%;animation:messageFadeIn .3s ease;}@keyframes messageFadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}#chat-page .message-ai{align-self:flex-start;}#chat-page .message-user{align-self:flex-end;flex-direction:row-reverse;}#chat-page .avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;}#chat-page .ai-avatar{background:var(--primary-gradient);color:white;}#chat-page .user-msg-avatar{background:#6c5ce7;color:white;}#chat-page .message-content{padding:18px;border-radius:var(--radius);line-height:1.6;background-color:var(--message-ai-bg);color:var(--text-primary);word-break:break-word;}#chat-page .message-content img{max-width:100%;border-radius:var(--radius-small);margin-top:10px;}#chat-page .message-content a{color:var(--primary);text-decoration:none;}#chat-page .message-content a:hover{text-decoration:underline;}#chat-page .message-user .message-content{background-color:var(--message-user-bg);}#chat-page .message-content pre{position:relative;background-color:var(--code-bg);padding:16px;border-radius:var(--radius-small);overflow-x:auto;margin:12px 0;font-size:14px;color:#abb2bf;}#chat-page .message-content pre .copy-btn{position:absolute;top:8px;right:8px;background:#4a4f58;border:1px solid #5f6368;color:#e8eaed;cursor:pointer;padding:4px 8px;border-radius:var(--radius-small);font-size:12px;opacity:0;transition:opacity .2s;}#chat-page .message-content pre:hover .copy-btn{opacity:1;}#chat-page .message-content p{margin:0;}#chat-page .message-content p:not(:last-child){margin-bottom:1em;}#chat-page .chat-input-container{padding:20px 24px;border-top:1px solid var(--border-color);background-color:var(--bg-color);}#chat-page .input-wrapper{display:flex;border:1px solid var(--border-color);border-radius:var(--radius);padding:8px 16px;background-color:var(--bg-color);align-items:center;gap:8px;}#chat-page .input-wrapper:focus-within{border-color:var(--primary);box-shadow:0 0 0 2px var(--primary-light);}#chat-page .chat-input{flex:1;border:none;outline:none;padding:14px 0;background:transparent;color:var(--text-primary);resize:none;max-height:150px;font-size:16px;}#chat-page .upload-btn,#chat-page .send-btn{background:var(--primary-gradient);border:none;color:white;cursor:pointer;font-size:14px;font-weight:500;width:44px;height:44px;border-radius:var(--radius-small);flex-shrink:0;transition:all .2s ease;display:flex;align-items:center;justify-content:center;}#chat-page .upload-btn{background:var(--bg-tertiary);color:var(--text-secondary);margin-right:4px;}#chat-page .upload-btn:hover{background:var(--border-color);}#chat-page .send-btn:hover{box-shadow:var(--shadow-hover);transform:translateY(-1px);}#chat-page .send-btn:disabled{background:var(--bg-tertiary);cursor:not-allowed;transform:none;box-shadow:none;color:var(--text-secondary);}#chat-page .send-btn .fa-spinner{animation:spin 1s linear infinite;}.context-menu{position:absolute;background:var(--bg-color);border-radius:var(--radius);box-shadow:var(--shadow-hover);z-index:1000;padding:8px;min-width:160px;display:none;border:1px solid var(--border-color);}.context-menu button{width:100%;text-align:left;padding:12px 16px;background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:10px;color:var(--text-primary);font-size:14px;border-radius:var(--radius-small);}.context-menu button:hover{background-color:var(--bg-tertiary);color:var(--primary);}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:1000;display:none;backdrop-filter:blur(5px);}.modal{background:var(--bg-color);border-radius:var(--radius);padding:32px;width:90%;max-width:400px;box-shadow:var(--shadow-hover);animation:fadeIn .3s;border:1px solid var(--border-color);}.modal h3{margin-bottom:16px;font-family:'Poppins',sans-serif;color:var(--text-primary);}.modal p{color:var(--text-secondary);margin-bottom:24px;}.modal-input{width:100%;padding:14px;border:1px solid var(--border-color);border-radius:var(--radius-small);margin-bottom:20px;font-family:'Inter',sans-serif;background:var(--bg-secondary);color:var(--text-primary);font-size:16px;}.modal-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 2px var(--primary-light);}.modal-actions{display:flex;justify-content:flex-end;gap:12px;}.modal-btn{padding:10px 24px;border-radius:var(--radius-small);border:none;cursor:pointer;font-weight:600;transition:all .2s;}.modal-btn-primary{background:var(--primary);color:white;}.modal-btn-primary:hover{opacity:0.9;transform:translateY(-1px);}.modal-btn-secondary{background:var(--bg-tertiary);color:var(--text-primary);border:1px solid var(--border-color);}.modal-btn-secondary:hover{background:var(--border-color);}@media (max-width:768px){#chat-page .menu-toggle{display:block;}#chat-page .sidebar{position:fixed;left:0;top:0;height:100%;z-index:100;transform:translateX(-100%);border-right:1px solid var(--border-color);}#chat-page .sidebar.active{transform:translateX(0);box-shadow:var(--shadow-hover);}#chat-page .sidebar-overlay.active{display:block;}}</style></head><body><div id="login-page"><div class="login-container"><div class="login-header"><h1>TutorUp</h1><p>Please SignIn To Continue</p></div><div class="form-container"><form id="loginForm"><div class="input-group"><label for="loginEmail">Email</label><input type="email" id="loginEmail" placeholder="Enter your email" required><i class="fas fa-envelope"></i></div><div class="input-group"><label for="loginPassword">Password</label><input type="password" id="loginPassword" placeholder="Enter your password" required><i class="fas fa-lock"></i></div><button type="submit" class="btn" id="loginBtn"><div class="loader" id="loginLoader"></div><span id="loginBtnText">Sign In</span></button><div id="errorMessage" class="alert"></div></form></div></div></div><div id="chat-page" style="display: none;"><header class="header"><div class="header-left"><button class="menu-toggle" id="menu-toggle" aria-label="Toggle Menu"><i class="fas fa-bars"></i></button><div class="logo"><i class="fas fa-brain logo-icon"></i><span>TutorUp</span></div></div><div class="header-actions"><button class="theme-toggle" id="theme-toggle" aria-label="Toggle Theme"><i class="fas fa-moon"></i></button><button class="logout-btn" id="logout-btn" aria-label="Logout"><i class="fas fa-sign-out-alt"></i></button></div></header><main class="main"><div class="sidebar-overlay" id="sidebar-overlay"></div><aside class="sidebar" id="sidebar"><button class="new-chat-btn" id="new-chat-btn"><i class="fas fa-plus"></i>New Chat</button><div class="history-list" id="history-list"></div></aside><section class="chat-container"><div class="chat-messages" id="chat-messages"></div><div class="chat-input-container"><div class="input-wrapper"><button class="upload-btn" id="upload-btn" aria-label="Upload file"><i class="fas fa-link"></i></button><textarea class="chat-input" id="chat-input" rows="1"></textarea><button class="send-btn" id="send-btn" aria-label="Send message"><i class="fas fa-paper-plane"></i></button></div></div></section></main></div><div class="context-menu" id="context-menu"><button id="rename-chat-btn"><i class="fas fa-edit"></i>Rename</button><button id="delete-chat-btn"><i class="fas fa-trash"></i>Delete</button></div><div class="modal-overlay" id="rename-modal"><div class="modal"><h3>Rename Chat</h3><input type="text" class="modal-input" id="rename-input" placeholder="Enter new chat name"><div class="modal-actions"><button class="modal-btn modal-btn-secondary" id="rename-cancel">Cancel</button><button class="modal-btn modal-btn-primary" id="rename-save">Save</button></div></div></div><div class="modal-overlay" id="alert-modal"><div class="modal"><h3 id="alert-title"></h3><p id="alert-message"></p><div class="modal-actions" id="alert-actions"><button class="modal-btn modal-btn-secondary" id="alert-cancel">Cancel</button><button class="modal-btn modal-btn-primary" id="alert-ok">OK</button></div></div></div><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js" defer></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js" defer></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js" defer></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js" defer></script><script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" defer></script><script>document.addEventListener('contextmenu',e=>e.preventDefault());document.onkeydown=function(e){if(e.keyCode==123)return false;if(e.ctrlKey&&e.shiftKey&&e.keyCode=='I'.charCodeAt(0))return false;if(e.ctrlKey&&e.shiftKey&&e.keyCode=='J'.charCodeAt(0))return false;if(e.ctrlKey&&e.keyCode=='U'.charCodeAt(0))return false;};const v_0={apiKey:"AIzaSyB7t1epo6Vsi-zhjmFoYEkznUfmAoxfRyY",authDomain:"tutorup-dilshad.firebaseapp.com",projectId:"tutorup-dilshad",storageBucket:"tutorup-dilshad.appspot.com",messagingSenderId:"845385268581",appId:"1:845385268581:web:8af0729bd46012dc3a758c",measurementId:"G-XQE1WF1V63",databaseURL:"https://tutorup-dilshad-default-rtdb.firebaseio.com/"};firebase.initializeApp(v_0);const v_1=firebase.auth();const v_2=firebase.firestore();const v_3=firebase.storage();v_1.setPersistence(firebase.auth.Auth.Persistence.LOCAL);const v_4=document.getElementById('login-page');const v_5=document.getElementById('chat-page');const v_7=document.getElementById('loginForm');const v_8=document.getElementById('loginEmail');const v_9=document.getElementById('loginPassword');const v_10=document.getElementById('loginBtn');const v_11=document.getElementById('loginLoader');const v_12=document.getElementById('loginBtnText');const v_13=document.getElementById('errorMessage');const v_14=document.getElementById('chat-messages');const v_15=document.getElementById('chat-input');const v_16=document.getElementById('send-btn');const v_17=document.getElementById('upload-btn');const v_18=document.getElementById('theme-toggle');const v_19=document.getElementById('menu-toggle');const v_20=document.getElementById('sidebar');const v_21=document.getElementById('sidebar-overlay');const v_22=document.getElementById('new-chat-btn');const v_23=document.getElementById('logout-btn');const v_24=document.getElementById('history-list');const v_25=document.getElementById('context-menu');const v_26=document.getElementById('rename-modal');const v_27=document.getElementById('rename-input');const v_28=document.getElementById('rename-save');const v_29=document.getElementById('rename-cancel');const v_30=document.getElementById('rename-chat-btn');const v_31=document.getElementById('delete-chat-btn');let v_32=[];let v_33=null;let v_34=null;let v_35=null;let v_36=null;let v_37=null;let v_38=null;function f_0(l){v_10.disabled=l;v_11.style.display=l?'block':'none';v_12.textContent=l?'Signing In...':'Sign In';}function f_1(m){v_13.textContent=m;v_13.style.display='block';}v_8.addEventListener('input',()=>f_1.style.display='none');v_9.addEventListener('input',()=>f_1.style.display='none');const f_2=()=>{document.documentElement.style.setProperty('--app-height',`${window.innerHeight}px`)};window.addEventListener('resize',f_2);f_2();v_18.addEventListener('click',()=>{document.body.classList.toggle('dark-theme');v_5.classList.toggle('dark-theme');v_18.innerHTML=document.body.classList.contains('dark-theme')?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>';});const f_3=()=>{v_20.classList.toggle('active');v_21.classList.toggle('active');};v_19.addEventListener('click',f_3);v_21.addEventListener('click',f_3);v_15.addEventListener('input',function(){this.style.height='auto';this.style.height=`${this.scrollHeight}px`;});function f_4(){let s=localStorage.getItem('tutorup_session_id');if(!s){s=`${Date.now()}_${Math.random().toString(36).slice(2)}`;localStorage.setItem('tutorup_session_id',s);}return s;}const v_39=f_4();function f_5(){if(v_36){v_36();v_36=null;}if(v_37){v_37();v_37=null;}if(v_38){v_38();v_38=null;}v_33=null;v_32=[];v_24.innerHTML='';v_14.innerHTML='';}function f_6(m,t='Notification',c=null,s=false){const aM=document.getElementById('alert-modal');const aT=document.getElementById('alert-title');const aMsg=document.getElementById('alert-message');const aOk=document.getElementById('alert-ok');const aC=document.getElementById('alert-cancel');aT.textContent=t;aMsg.textContent=m;aC.style.display=s?'block':'none';aM.style.display='flex';const oH=()=>{aM.style.display='none';if(c)c(true);aOk.removeEventListener('click',oH);aC.removeEventListener('click',cH);};const cH=()=>{aM.style.display='none';if(c)c(false);aOk.removeEventListener('click',oH);aC.removeEventListener('click',cH);};aOk.addEventListener('click',oH);aC.addEventListener('click',cH);}v_1.onAuthStateChanged(async(u)=>{if(u){v_34=u.uid;v_4.style.display='none';v_5.style.display='flex';document.body.style.background='var(--bg-color)';await f_9(v_34);f_10(v_34);}else{f_5();v_34=null;v_5.style.display='none';v_4.style.display='flex';document.body.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)';}});v_7.addEventListener('submit',(e)=>{e.preventDefault();const em=v_8.value.trim();const p=v_9.value.trim();if(!em||!p){f_1("Please enter both email and password.");return;}f_0(true);v_1.signInWithEmailAndPassword(em,p).catch((err)=>{let fE="An error occurred. Please try again.";switch(err.code){case'auth/invalid-email':case'auth/user-disabled':case'auth/user-not-found':case'auth/wrong-password':case'auth/invalid-credential':fE="Incorrect email or password.";break;}f_1(fE);}).finally(()=>f_0(false));});async function f_9(u){try{const dR=v_2.collection('activeSessions').doc(u);await dR.set({sessionId:v_39,lastActive:firebase.firestore.FieldValue.serverTimestamp()},{merge:true});if(v_38)v_38();v_38=dR.onSnapshot(s=>{if(!s.exists)return;const d=s.data();if(d.sessionId&&d.sessionId!==v_39){f_6('You have been logged out because your account was opened on another device.','Session Conflict',()=>{v_1.signOut();});}});}}catch(err){console.error("Session tracking error:",err);}}function f_10(u){if(v_36)v_36();v_36=v_2.collection('chats').where('userId','==',u).orderBy('createdAt','desc').onSnapshot(s=>{v_24.innerHTML='';if(s.empty){f_16();return;}s.forEach(d=>{const dt=d.data();f_11(d.id,dt.name||'New Chat');});if(!v_33&&s.docs.length>0){f_17(s.docs[0].id);}},err=>{console.error("Error listening to chats:",err);});}function f_11(cI,cN){if(document.querySelector(`.history-item[data-chat-id="${cI}"]`))return;const cIt=document.createElement('div');cIt.className='history-item';cIt.dataset.chatId=cI;cIt.innerHTML=`<i class="fas fa-comment-dots"></i><span>${cN}</span>`;cIt.addEventListener('click',()=>{f_17(cI);if(window.innerWidth<=768)f_3();});cIt.addEventListener('contextmenu',(e)=>{e.preventDefault();v_35=cI;f_12(e);});let pT;cIt.addEventListener('touchstart',(e)=>{pT=setTimeout(()=>{e.preventDefault();v_35=cI;f_12(e);},500);});cIt.addEventListener('touchend',()=>clearTimeout(pT));v_24.appendChild(cIt);}function f_12(e){v_25.style.display='block';let l=(e.pageX||(e.touches&&e.touches[0].pageX)||100);let t=(e.pageY||(e.touches&&e.touches[0].pageY)||100);if(l+v_25.offsetWidth>window.innerWidth-10){l=window.innerWidth-v_25.offsetWidth-10;}if(t+v_25.offsetHeight>window.innerHeight-10){t=window.innerHeight-v_25.offsetHeight-10;}v_25.style.left=`${l}px`;v_25.style.top=`${t}px`;const cM=(ev)=>{if(!v_25.contains(ev.target)){v_25.style.display='none';document.removeEventListener('click',cM);document.removeEventListener('touchstart',cM);}};setTimeout(()=>{document.addEventListener('click',cM);document.addEventListener('touchstart',cM);},0);}v_30.addEventListener('click',()=>{v_25.style.display='none';if(!v_35)return;v_2.collection('chats').doc(v_35).get().then(d=>{if(d.exists){v_27.value=d.data().name||'';v_26.style.display='flex';v_27.focus();}}).catch(err=>console.error("Error fetching chat for rename:",err));});v_31.addEventListener('click',()=>{v_25.style.display='none';if(!v_35)return;f_6("Are you sure you want to delete this chat and all its messages? This action cannot be undone.", "Confirm Deletion", (c)=>{if(c){v_2.collection('chats').doc(v_35).delete().then(()=>{const cI=document.querySelector(`.history-item[data-chat-id="${v_35}"]`);if(cI)cI.remove();if(v_33===v_35){v_33=null;v_32=[];v_14.innerHTML='';f_16();}}).catch(err=>console.error("Error deleting chat:",err));}}, true);});v_28.addEventListener('click',()=>{const nN=v_27.value.trim();if(!nN||!v_35)return;v_2.collection('chats').doc(v_35).update({name:nN}).then(()=>{const s=document.querySelector(`.history-item[data-chat-id="${v_35}"] span`);if(s)s.textContent=nN;v_26.style.display='none';}).catch(err=>console.error("Error renaming chat:",err));});v_29.addEventListener('click',()=>v_26.style.display='none');function f_16(){if(!v_34){console.warn("Cannot create chat: user not set.");return;}const cN=`New Chat`;const cD={userId:v_34,name:cN,messages:[],createdAt:firebase.firestore.FieldValue.serverTimestamp(),updatedAt:firebase.firestore.FieldValue.serverTimestamp()};v_2.collection('chats').add(cD).then(dR=>{f_11(dR.id,cN);f_17(dR.id);}).catch(err=>console.error("Error creating new chat:",err));}v_22.addEventListener('click',f_16);function f_17(cI){if(v_37)v_37();v_33=cI;document.querySelectorAll('.history-item').forEach(i=>i.classList.remove('active'));const aI=document.querySelector(`.history-item[data-chat-id="${cI}"]`);if(aI)aI.classList.add('active');v_37=v_2.collection('chats').doc(cI).onSnapshot(d=>{if(!d.exists){v_32=[];v_14.innerHTML='';v_33=null;return;}const dt=d.data();v_32=dt.messages||[];f_18();},err=>{console.error("Error loading chat doc:",err);});}function f_18(){v_14.innerHTML='';v_32.forEach(m=>{const e=f_19(m);v_14.appendChild(e);});v_14.scrollTop=v_14.scrollHeight;}function f_19(mO){const mD=document.createElement('div');mD.className='message '+(mO.role==='user'?'message-user':'message-ai');const aH=mO.role==='user'?'<div class="avatar user-msg-avatar"><i class="fas fa-user"></i></div>':'<div class="avatar ai-avatar"><i class="fas fa-robot"></i></div>';const cH=`<div class="message-content">${marked.parse(mO.text||'')}</div>`;mD.innerHTML=`${aH}${cH}`;setTimeout(()=>{try{renderMathInElement(mD,{delimiters:[{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false},{left:'\\[',right:'\\]',display:true}],throwOnError:false});}catch(err){console.warn("KaTeX render error:",err);}},0);return mD;}function f_20(mO){if(!v_33)return Promise.reject("No chat selected");const p={role:mO.role,text:mO.text,ts:Date.now()};return v_2.collection('chats').doc(v_33).update({messages:firebase.firestore.FieldValue.arrayUnion(p),updatedAt:firebase.firestore.FieldValue.serverTimestamp()});}function f_21(t){if(!v_33){f_16();setTimeout(()=>f_21(t),600);return;}const mO={role:'user',text:t};v_32.push({role:mO.role,text:mO.text,ts:Date.now()});v_14.appendChild(f_19(mO));v_14.scrollTop=v_14.scrollHeight;f_20(mO).catch(err=>console.error("Error persisting user message:",err));}function f_22(t){if(!v_33){console.warn("No chat selected to add AI message");return;}const mO={role:'model',text:t};v_32.push({role:mO.role,text:mO.text,ts:Date.now()});v_14.appendChild(f_19(mO));v_14.scrollTop=v_14.scrollHeight;f_20({role:'model',text:t}).catch(err=>console.error("Error persisting ai message:",err));}v_16.addEventListener('click',f_13);v_15.addEventListener('keydown',(e)=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();f_13();}});const v_40="YOUR_GEMINI_API_KEY";function f_13(){const m=v_15.value;if(!m||!m.trim())return;f_21(m);v_15.value='';v_15.style.height='auto';v_16.disabled=true;v_16.innerHTML='<i class="fas fa-spinner"></i>';const rB={contents:v_32.filter(m=>m.text).map(m=>({role:m.role==='user'?'user':'model',parts:[{text:m.text}]}))};fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${v_40}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(rB)}).then(r=>r.json()).then(d=>{try{const aR=d?.candidates?.[0]?.content?.parts?.[0]?.text;if(aR){f_22(aR);}else{f_22("Sorry, I couldn't generate a response right now.");}}catch(err){console.error("Error parsing AI response:",err);f_22("Sorry, I'm having trouble responding right now. Please try again later.");}}).catch(err=>{console.error('Error calling Gemini API:',err);f_22("Sorry, I'm having trouble responding right now. Please try again later.");}).finally(()=>{v_16.disabled=false;v_16.innerHTML='<i class="fas fa-paper-plane"></i>';});}const fI=document.createElement('input');fI.type='file';fI.accept="image/*,application/pdf,.doc,.docx,.ppt,.pptx,.txt";fI.capture="environment";fI.style.display='none';document.body.appendChild(fI);v_17.addEventListener('click',()=>{fI.click();});fI.addEventListener('change',async(e)=>{const f=e.target.files[0];if(!f)return;if(!v_34||!v_33){f_6("Please sign in and select a chat before uploading files.");return;}const p=`uploads/${v_34}/${Date.now()}_${f.name.replace(/\s+/g,'_')}`;const sR=v_3.ref(p);let dN=f.name;if(dN.length>25){dN=dN.substring(0,12)+'...'+dN.substring(dN.length-10);}f_21(`Uploading ${dN}...`);try{const uS=await sR.put(f);const u=await sR.getDownloadURL();if(f.type.startsWith("image/")){f_21(`![](${u})`);}else{f_21(`[${f.name}](${u})`);}}catch(err){console.error("File upload error:",err);f_22("âŒ File upload failed. Please try again.");}finally{fI.value='';}});v_23.addEventListener('click',()=>{v_1.signOut().catch(err=>console.error('Sign out error',err));});</script></body></html>
